<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>libmesh解析: libMesh::PetscDMWrapper类 参考</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">libmesh解析
   </div>
   <div id="projectbrief">本工作只是尝试解析原libmesh的代码,供学习使用</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'搜索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>首页</span></a></li>
      <li class="current"><a href="annotated.html"><span>类</span></a></li>
      <li><a href="files.html"><span>文件</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="搜索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>类列表</span></a></li>
      <li><a href="classes.html"><span>类索引</span></a></li>
      <li><a href="inherits.html"><span>类继承关系</span></a></li>
      <li><a href="functions.html"><span>类成员</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>全部</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>类</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>命名空间</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>文件</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>函数</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>变量</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>类型定义</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>枚举</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>枚举值</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>友元</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>页</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacelibMesh.html">libMesh</a></li><li class="navelem"><a class="el" href="classlibMesh_1_1PetscDMWrapper.html">PetscDMWrapper</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public 成员函数</a> &#124;
<a href="#pri-methods">Private 成员函数</a> &#124;
<a href="#pri-attribs">Private 属性</a> &#124;
<a href="classlibMesh_1_1PetscDMWrapper-members.html">所有成员列表</a>  </div>
  <div class="headertitle">
<div class="title">libMesh::PetscDMWrapper类 参考</div>  </div>
</div><!--header-->
<div class="contents">

<p>This class defines a wrapper around the PETSc DM infrastructure.  
 <a href="classlibMesh_1_1PetscDMWrapper.html#details">更多...</a></p>

<p><code>#include &lt;<a class="el" href="petsc__dm__wrapper_8h_source.html">petsc_dm_wrapper.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public 成员函数</h2></td></tr>
<tr class="memitem:acee98aea761f74b78fb6a969f6244286"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibMesh_1_1PetscDMWrapper.html#acee98aea761f74b78fb6a969f6244286">PetscDMWrapper</a> ()=default</td></tr>
<tr class="separator:acee98aea761f74b78fb6a969f6244286"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a112077efd9d815591e2a074a24c6c515"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibMesh_1_1PetscDMWrapper.html#a112077efd9d815591e2a074a24c6c515">~PetscDMWrapper</a> ()</td></tr>
<tr class="separator:a112077efd9d815591e2a074a24c6c515"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a89d3f9c0a20bdf40beb55266d17615ab"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibMesh_1_1PetscDMWrapper.html#a89d3f9c0a20bdf40beb55266d17615ab">clear</a> ()</td></tr>
<tr class="memdesc:a89d3f9c0a20bdf40beb55266d17615ab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destroys and clears all build DM-related data.  <a href="#a89d3f9c0a20bdf40beb55266d17615ab">更多...</a><br/></td></tr>
<tr class="separator:a89d3f9c0a20bdf40beb55266d17615ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2df0375f2aafe4f68ddb9276ce76798e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibMesh_1_1PetscDMWrapper.html#a2df0375f2aafe4f68ddb9276ce76798e">init_and_attach_petscdm</a> (<a class="el" href="classlibMesh_1_1System.html">System</a> &amp;system, SNES &amp;snes)</td></tr>
<tr class="separator:a2df0375f2aafe4f68ddb9276ce76798e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private 成员函数</h2></td></tr>
<tr class="memitem:a2d70713d86345846096c6ef22258cf14"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibMesh_1_1PetscDMWrapper.html#a2d70713d86345846096c6ef22258cf14">init_dm_data</a> (unsigned int n_levels, const Parallel::Communicator &amp;comm)</td></tr>
<tr class="memdesc:a2d70713d86345846096c6ef22258cf14"><td class="mdescLeft">&#160;</td><td class="mdescRight">Init all the n_mesh_level dependent data structures.  <a href="#a2d70713d86345846096c6ef22258cf14">更多...</a><br/></td></tr>
<tr class="separator:a2d70713d86345846096c6ef22258cf14"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34bd5c1fa064d2c382a52607f4465c8f"><td class="memItemLeft" align="right" valign="top">DM &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibMesh_1_1PetscDMWrapper.html#a34bd5c1fa064d2c382a52607f4465c8f">get_dm</a> (unsigned int level)</td></tr>
<tr class="memdesc:a34bd5c1fa064d2c382a52607f4465c8f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get reference to DM for the given mesh level.  <a href="#a34bd5c1fa064d2c382a52607f4465c8f">更多...</a><br/></td></tr>
<tr class="separator:a34bd5c1fa064d2c382a52607f4465c8f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6295b51ea21d5501420c2c171ac0afa6"><td class="memItemLeft" align="right" valign="top">PetscSection &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibMesh_1_1PetscDMWrapper.html#a6295b51ea21d5501420c2c171ac0afa6">get_section</a> (unsigned int level)</td></tr>
<tr class="memdesc:a6295b51ea21d5501420c2c171ac0afa6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get reference to PetscSection for the given mesh level.  <a href="#a6295b51ea21d5501420c2c171ac0afa6">更多...</a><br/></td></tr>
<tr class="separator:a6295b51ea21d5501420c2c171ac0afa6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed2e29d969ca4c92ed1770477aa1a7ba"><td class="memItemLeft" align="right" valign="top">PetscSF &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibMesh_1_1PetscDMWrapper.html#aed2e29d969ca4c92ed1770477aa1a7ba">get_star_forest</a> (unsigned int level)</td></tr>
<tr class="memdesc:aed2e29d969ca4c92ed1770477aa1a7ba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get reference to PetscSF for the given mesh level.  <a href="#aed2e29d969ca4c92ed1770477aa1a7ba">更多...</a><br/></td></tr>
<tr class="separator:aed2e29d969ca4c92ed1770477aa1a7ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9ebb64f4d3f5f353f91ac2fcbe6a198"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibMesh_1_1PetscDMWrapper.html#af9ebb64f4d3f5f353f91ac2fcbe6a198">build_section</a> (const <a class="el" href="classlibMesh_1_1System.html">System</a> &amp;system, PetscSection &amp;section)</td></tr>
<tr class="memdesc:af9ebb64f4d3f5f353f91ac2fcbe6a198"><td class="mdescLeft">&#160;</td><td class="mdescRight">Takes <a class="el" href="classlibMesh_1_1System.html" title="Manages consistently variables, degrees of freedom, and coefficient vectors. ">System</a>, empty PetscSection and populates the PetscSection.  <a href="#af9ebb64f4d3f5f353f91ac2fcbe6a198">更多...</a><br/></td></tr>
<tr class="separator:af9ebb64f4d3f5f353f91ac2fcbe6a198"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab9a1fd9620e6cbef319c215a7341e8d4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibMesh_1_1PetscDMWrapper.html#ab9a1fd9620e6cbef319c215a7341e8d4">build_sf</a> (const <a class="el" href="classlibMesh_1_1System.html">System</a> &amp;system, PetscSF &amp;star_forest)</td></tr>
<tr class="memdesc:ab9a1fd9620e6cbef319c215a7341e8d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Takes <a class="el" href="classlibMesh_1_1System.html" title="Manages consistently variables, degrees of freedom, and coefficient vectors. ">System</a>, empty PetscSF and populates the PetscSF.  <a href="#ab9a1fd9620e6cbef319c215a7341e8d4">更多...</a><br/></td></tr>
<tr class="separator:ab9a1fd9620e6cbef319c215a7341e8d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f5911ff56027bac98ee7000d81ab3c2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibMesh_1_1PetscDMWrapper.html#a6f5911ff56027bac98ee7000d81ab3c2">set_point_range_in_section</a> (const <a class="el" href="classlibMesh_1_1System.html">System</a> &amp;system, PetscSection &amp;section, std::unordered_map&lt; <a class="el" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a>, <a class="el" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a> &gt; &amp;node_map, std::unordered_map&lt; <a class="el" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a>, <a class="el" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a> &gt; &amp;elem_map, std::map&lt; <a class="el" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a>, unsigned int &gt; &amp;scalar_map)</td></tr>
<tr class="memdesc:a6f5911ff56027bac98ee7000d81ab3c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper function for build_section.  <a href="#a6f5911ff56027bac98ee7000d81ab3c2">更多...</a><br/></td></tr>
<tr class="separator:a6f5911ff56027bac98ee7000d81ab3c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4cab51fa93c6f9253c31726ac0806755"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibMesh_1_1PetscDMWrapper.html#a4cab51fa93c6f9253c31726ac0806755">add_dofs_to_section</a> (const <a class="el" href="classlibMesh_1_1System.html">System</a> &amp;system, PetscSection &amp;section, const std::unordered_map&lt; <a class="el" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a>, <a class="el" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a> &gt; &amp;node_map, const std::unordered_map&lt; <a class="el" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a>, <a class="el" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a> &gt; &amp;elem_map, const std::map&lt; <a class="el" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a>, unsigned int &gt; &amp;scalar_map)</td></tr>
<tr class="memdesc:a4cab51fa93c6f9253c31726ac0806755"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper function for build_section.  <a href="#a4cab51fa93c6f9253c31726ac0806755">更多...</a><br/></td></tr>
<tr class="separator:a4cab51fa93c6f9253c31726ac0806755"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d41770849fa0210d915d9644de9f176"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibMesh_1_1PetscDMWrapper.html#a8d41770849fa0210d915d9644de9f176">check_section_n_dofs</a> (PetscSection &amp;section)</td></tr>
<tr class="memdesc:a8d41770849fa0210d915d9644de9f176"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper function to sanity check PetscSection construction The PetscSection contains local dof information.  <a href="#a8d41770849fa0210d915d9644de9f176">更多...</a><br/></td></tr>
<tr class="separator:a8d41770849fa0210d915d9644de9f176"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a740f44c588717f1ef575fd2bd3674fe8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibMesh_1_1PetscDMWrapper.html#a740f44c588717f1ef575fd2bd3674fe8">add_dofs_helper</a> (const <a class="el" href="classlibMesh_1_1System.html">System</a> &amp;system, const <a class="el" href="classlibMesh_1_1DofObject.html">DofObject</a> &amp;dof_object, <a class="el" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a> local_id, PetscSection &amp;section)</td></tr>
<tr class="separator:a740f44c588717f1ef575fd2bd3674fe8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private 属性</h2></td></tr>
<tr class="memitem:aa4d26a0e9269059e4e3436368ed29060"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="structlibMesh_1_1WrappedPetsc.html">WrappedPetsc</a>&lt; DM &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibMesh_1_1PetscDMWrapper.html#aa4d26a0e9269059e4e3436368ed29060">_dms</a></td></tr>
<tr class="memdesc:aa4d26a0e9269059e4e3436368ed29060"><td class="mdescLeft">&#160;</td><td class="mdescRight">Vector of DMs for all grid levels.  <a href="#aa4d26a0e9269059e4e3436368ed29060">更多...</a><br/></td></tr>
<tr class="separator:aa4d26a0e9269059e4e3436368ed29060"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b64223ac3403b535b0d687825aa16b1"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="structlibMesh_1_1WrappedPetsc.html">WrappedPetsc</a><br class="typebreak"/>
&lt; PetscSection &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibMesh_1_1PetscDMWrapper.html#a7b64223ac3403b535b0d687825aa16b1">_sections</a></td></tr>
<tr class="memdesc:a7b64223ac3403b535b0d687825aa16b1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Vector of PETScSections for all grid levels.  <a href="#a7b64223ac3403b535b0d687825aa16b1">更多...</a><br/></td></tr>
<tr class="separator:a7b64223ac3403b535b0d687825aa16b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8258edc20f6aa9603bc0ee44cd98132b"><td class="memItemLeft" align="right" valign="top">std::vector&lt; PetscSF &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibMesh_1_1PetscDMWrapper.html#a8258edc20f6aa9603bc0ee44cd98132b">_star_forests</a></td></tr>
<tr class="memdesc:a8258edc20f6aa9603bc0ee44cd98132b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Vector of star forests for all grid levels.  <a href="#a8258edc20f6aa9603bc0ee44cd98132b">更多...</a><br/></td></tr>
<tr class="separator:a8258edc20f6aa9603bc0ee44cd98132b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8db0313aa38a2acc547b5fefaac50027"><td class="memItemLeft" align="right" valign="top">std::vector&lt; std::unique_ptr<br class="typebreak"/>
&lt; <a class="el" href="classlibMesh_1_1PetscMatrix.html">PetscMatrix</a>&lt; <a class="el" href="namespacelibMesh.html#a8b17bf24a15bc292850c3a3894e2e8f9">Number</a> &gt; &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibMesh_1_1PetscDMWrapper.html#a8db0313aa38a2acc547b5fefaac50027">_pmtx_vec</a></td></tr>
<tr class="memdesc:a8db0313aa38a2acc547b5fefaac50027"><td class="mdescLeft">&#160;</td><td class="mdescRight">Vector of projection matrixes for all grid levels.  <a href="#a8db0313aa38a2acc547b5fefaac50027">更多...</a><br/></td></tr>
<tr class="separator:a8db0313aa38a2acc547b5fefaac50027"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e8ca5ec9955c8f2a2813ca8a70c922e"><td class="memItemLeft" align="right" valign="top">std::vector&lt; std::unique_ptr<br class="typebreak"/>
&lt; <a class="el" href="classlibMesh_1_1PetscMatrix.html">PetscMatrix</a>&lt; <a class="el" href="namespacelibMesh.html#a8b17bf24a15bc292850c3a3894e2e8f9">Number</a> &gt; &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibMesh_1_1PetscDMWrapper.html#a2e8ca5ec9955c8f2a2813ca8a70c922e">_subpmtx_vec</a></td></tr>
<tr class="memdesc:a2e8ca5ec9955c8f2a2813ca8a70c922e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Vector of sub projection matrixes for all grid levels for fieldsplit.  <a href="#a2e8ca5ec9955c8f2a2813ca8a70c922e">更多...</a><br/></td></tr>
<tr class="separator:a2e8ca5ec9955c8f2a2813ca8a70c922e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa29b614c713146bf8be8dc066ac4cdc3"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="structlibMesh_1_1PetscDMContext.html">PetscDMContext</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">_ctx_vec</a></td></tr>
<tr class="memdesc:aa29b614c713146bf8be8dc066ac4cdc3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Vector of internal PetscDM context structs for all grid levels Pointers to these C++ objects are passed to DMShellSetContext(), they are cleaned up automatically by their destructors.  <a href="#aa29b614c713146bf8be8dc066ac4cdc3">更多...</a><br/></td></tr>
<tr class="separator:aa29b614c713146bf8be8dc066ac4cdc3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d2cb2619787d5e29185d720bf5d74f1"><td class="memItemLeft" align="right" valign="top">std::vector&lt; std::unique_ptr<br class="typebreak"/>
&lt; <a class="el" href="classlibMesh_1_1PetscVector.html">PetscVector</a>&lt; <a class="el" href="namespacelibMesh.html#a8b17bf24a15bc292850c3a3894e2e8f9">Number</a> &gt; &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibMesh_1_1PetscDMWrapper.html#a5d2cb2619787d5e29185d720bf5d74f1">_vec_vec</a></td></tr>
<tr class="memdesc:a5d2cb2619787d5e29185d720bf5d74f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Vector of solution vectors for all grid levels.  <a href="#a5d2cb2619787d5e29185d720bf5d74f1">更多...</a><br/></td></tr>
<tr class="separator:a5d2cb2619787d5e29185d720bf5d74f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade81e2a381216f2d8ba1be473e46fc30"><td class="memItemLeft" align="right" valign="top">std::vector&lt; unsigned int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibMesh_1_1PetscDMWrapper.html#ade81e2a381216f2d8ba1be473e46fc30">_mesh_dof_sizes</a></td></tr>
<tr class="memdesc:ade81e2a381216f2d8ba1be473e46fc30"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stores n_dofs for each grid level, to be used for projection matrix sizing.  <a href="#ade81e2a381216f2d8ba1be473e46fc30">更多...</a><br/></td></tr>
<tr class="separator:ade81e2a381216f2d8ba1be473e46fc30"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad236a8053fde71cf4344bc02c8af40a9"><td class="memItemLeft" align="right" valign="top">std::vector&lt; unsigned int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlibMesh_1_1PetscDMWrapper.html#ad236a8053fde71cf4344bc02c8af40a9">_mesh_dof_loc_sizes</a></td></tr>
<tr class="memdesc:ad236a8053fde71cf4344bc02c8af40a9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stores n_local_dofs for each grid level, to be used for projection vector sizing.  <a href="#ad236a8053fde71cf4344bc02c8af40a9">更多...</a><br/></td></tr>
<tr class="separator:ad236a8053fde71cf4344bc02c8af40a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">详细描述</h2>
<div class="textblock"><p>This class defines a wrapper around the PETSc DM infrastructure. </p>
<p>By coordinating DM data structures with <a class="el" href="namespacelibMesh.html" title="The libMesh namespace provides an interface to certain functionality in the library. ">libMesh</a>, we can use <a class="el" href="namespacelibMesh.html" title="The libMesh namespace provides an interface to certain functionality in the library. ">libMesh</a> mesh hierarchies for geometric multigrid. Additionally, by setting the DM data, we can additionally (with or without multigrid) define recursive fieldsplits of our variables.</p>
<dl class="section author"><dt>作者</dt><dd>Paul T. Bauman, Boris Boutkov </dd></dl>
<dl class="section date"><dt>日期</dt><dd>2018 </dd></dl>

<p>在文件 <a class="el" href="petsc__dm__wrapper_8h_source.html">petsc_dm_wrapper.h</a> 第 <a class="el" href="petsc__dm__wrapper_8h_source.html#l00097">97</a> 行定义.</p>
</div><h2 class="groupheader">构造及析构函数说明</h2>
<a class="anchor" id="acee98aea761f74b78fb6a969f6244286"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">libMesh::PetscDMWrapper::PetscDMWrapper </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">default</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a112077efd9d815591e2a074a24c6c515"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">libMesh::PetscDMWrapper::~PetscDMWrapper </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">default</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">成员函数说明</h2>
<a class="anchor" id="a740f44c588717f1ef575fd2bd3674fe8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void libMesh::PetscDMWrapper::add_dofs_helper </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlibMesh_1_1System.html">System</a> &amp;&#160;</td>
          <td class="paramname"><em>system</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classlibMesh_1_1DofObject.html">DofObject</a> &amp;&#160;</td>
          <td class="paramname"><em>dof_object</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a>&#160;</td>
          <td class="paramname"><em>local_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscSection &amp;&#160;</td>
          <td class="paramname"><em>section</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>在文件 <a class="el" href="petsc__dm__wrapper_8C_source.html">petsc_dm_wrapper.C</a> 第 <a class="el" href="petsc__dm__wrapper_8C_source.html#l01019">1019</a> 行定义.</p>

<p>参考 <a class="el" href="parallel__object_8h_source.html#l00097">libMesh::ParallelObject::comm()</a>, <a class="el" href="petsc__dm__wrapper_8C_source.html#l00061">libMesh::ierr</a>, <a class="el" href="int__range_8h_source.html#l00134">libMesh::make_range()</a>, <a class="el" href="dof__object_8h_source.html#l00801">libMesh::DofObject::n_dofs()</a>, <a class="el" href="system_8h_source.html#l02349">libMesh::System::n_vars()</a> , 以及 <a class="el" href="system_8h_source.html#l02269">libMesh::System::number()</a>.</p>

<p>参考自 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00961">add_dofs_to_section()</a>.</p>
<div class="fragment"><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  {</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> total_n_dofs_at_dofobject = 0;</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    <span class="comment">// We are assuming variables are also numbered 0 to n_vars()-1</span></div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> v : <a class="code" href="namespacelibMesh.html#a18dea64f5cc7fa12c864d7571bb69d0b">make_range</a>(system.n_vars()))</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;      {</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_dofs_at_dofobject = dof_object.n_dofs(system.number(), v);</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;        <span class="keywordflow">if</span>( n_dofs_at_dofobject &gt; 0 )</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;          {</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;            PetscErrorCode <a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a> = PetscSectionSetFieldDof( section,</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;                                                           local_id,</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;                                                           v,</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;                                                           n_dofs_at_dofobject );</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;            CHKERRABORT(system.comm().get(),<a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>);</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;            total_n_dofs_at_dofobject += n_dofs_at_dofobject;</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;          }</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;      }</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    libmesh_assert_equal_to(total_n_dofs_at_dofobject, dof_object.n_dofs(system.number()));</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    PetscErrorCode ierr =</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;      PetscSectionSetDof( section, local_id, total_n_dofs_at_dofobject );</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    CHKERRABORT(system.comm().get(),<a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>);</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  }</div>
<div class="ttc" id="namespacelibMesh_html_a03d02ae8c0dab01091f6b27bd0765c7d"><div class="ttname"><a href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">libMesh::ierr</a></div><div class="ttdeci">PetscErrorCode PetscInt const PetscInt IS DM *subdm PetscErrorCode ierr</div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8C_source.html#l00061">petsc_dm_wrapper.C:61</a></div></div>
<div class="ttc" id="namespacelibMesh_html_a18dea64f5cc7fa12c864d7571bb69d0b"><div class="ttname"><a href="namespacelibMesh.html#a18dea64f5cc7fa12c864d7571bb69d0b">libMesh::make_range</a></div><div class="ttdeci">IntRange&lt; T &gt; make_range(T beg, T end)</div><div class="ttdoc">The 2-parameter make_range() helper function returns an IntRange&amp;lt;T&amp;gt; when both input parameters are of...</div><div class="ttdef"><b>Definition:</b> <a href="int__range_8h_source.html#l00134">int_range.h:134</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4cab51fa93c6f9253c31726ac0806755"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void libMesh::PetscDMWrapper::add_dofs_to_section </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlibMesh_1_1System.html">System</a> &amp;&#160;</td>
          <td class="paramname"><em>system</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscSection &amp;&#160;</td>
          <td class="paramname"><em>section</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::unordered_map&lt; <a class="el" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a>, <a class="el" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>node_map</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::unordered_map&lt; <a class="el" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a>, <a class="el" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>elem_map</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; <a class="el" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a>, unsigned int &gt; &amp;&#160;</td>
          <td class="paramname"><em>scalar_map</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Helper function for build_section. </p>
<p>This function will set the DoF info for each "point" in the PetscSection. </p>

<p>在文件 <a class="el" href="petsc__dm__wrapper_8C_source.html">petsc_dm_wrapper.C</a> 第 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00961">961</a> 行定义.</p>

<p>参考 <a class="el" href="petsc__dm__wrapper_8C_source.html#l01019">add_dofs_helper()</a>, <a class="el" href="parallel__object_8h_source.html#l00097">libMesh::ParallelObject::comm()</a>, <a class="el" href="mesh__base_8h_source.html#l00614">libMesh::MeshBase::elem_ref()</a>, <a class="el" href="system_8h_source.html#l02277">libMesh::System::get_mesh()</a>, <a class="el" href="fe__type_8h_source.html#l00080">libMesh::OrderWrapper::get_order()</a>, <a class="el" href="petsc__dm__wrapper_8C_source.html#l00061">libMesh::ierr</a>, <a class="el" href="namespacelibMesh.html#a4f791f2cb1525c37e7916d564c3b3b78">libMesh::libmesh_assert()</a>, <a class="el" href="mesh__communication_8C_source.html#l01308">mesh</a>, <a class="el" href="parallel__object_8h_source.html#l00103">libMesh::ParallelObject::n_processors()</a>, <a class="el" href="mesh__base_8h_source.html#l00571">libMesh::MeshBase::node_ref()</a>, <a class="el" href="fe__type_8h_source.html#l00201">libMesh::FEType::order</a>, <a class="el" href="parallel__object_8h_source.html#l00114">libMesh::ParallelObject::processor_id()</a>, <a class="el" href="classlibMesh_1_1MeshBase.html#a61954736112b225cf323b93f57cd70ed">libMesh::MeshBase::query_elem_ptr()</a>, <a class="el" href="classlibMesh_1_1MeshBase.html#a88d3228c36aa7b481f0f5d77f95bd021">libMesh::MeshBase::query_node_ptr()</a>, <a class="el" href="variable_8h_source.html#l00140">libMesh::Variable::type()</a> , 以及 <a class="el" href="system_8h_source.html#l02377">libMesh::System::variable()</a>.</p>

<p>参考自 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00713">build_section()</a>.</p>
<div class="fragment"><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  {</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <span class="keyword">const</span> MeshBase &amp; <a class="code" href="mesh__communication_8C.html#afaa03b874c297f4693d9cdef7f50f3c6">mesh</a> = system.get_mesh();</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    PetscErrorCode <a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    <span class="comment">// Now we go through and add dof information for each &quot;point&quot;.</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <span class="comment">// In libMesh, for most finite elements, we just associate those DoFs with the</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="comment">// geometric nodes. So can we loop over the nodes we cached in the node_map and</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    <span class="comment">// the DoFs for each field for that node. We need to give PETSc the local id</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    <span class="comment">// we built up in the node map.</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> [global_node_id, local_node_id] : node_map )</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      {</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        <a class="code" href="namespacelibMesh.html#a4f791f2cb1525c37e7916d564c3b3b78">libmesh_assert</a>( mesh.query_node_ptr(global_node_id) );</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        <span class="keyword">const</span> Node &amp; node = mesh.node_ref(global_node_id);</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;        this-&gt;<a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a740f44c588717f1ef575fd2bd3674fe8">add_dofs_helper</a>(system,node,local_node_id,section);</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;      }</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="comment">// Some finite element types associate dofs with the element. So now we go through</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <span class="comment">// any of those with the Elem as the point we add to the PetscSection with accompanying</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <span class="comment">// dofs</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> [global_elem_id, local_elem_id] : elem_map )</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;      {</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        <a class="code" href="namespacelibMesh.html#a4f791f2cb1525c37e7916d564c3b3b78">libmesh_assert</a>( mesh.query_elem_ptr(global_elem_id) );</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;        <span class="keyword">const</span> Elem &amp; elem = mesh.elem_ref(global_elem_id);</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        this-&gt;<a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a740f44c588717f1ef575fd2bd3674fe8">add_dofs_helper</a>(system,elem,local_elem_id,section);</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      }</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <span class="comment">// Now add any SCALAR dofs to the PetscSection</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    <span class="comment">// SCALAR dofs live on the &quot;last&quot; processor, so only work there if there are any</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    <span class="keywordflow">if</span> (system.processor_id() == (system.n_processors()-1))</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      {</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> [local_id, scalar_var] : scalar_map )</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;          {</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;            <span class="comment">// The number of SCALAR dofs comes from the variable order</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> n_dofs = system.variable(scalar_var).type().order.get_order();</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;            ierr = PetscSectionSetFieldDof( section, local_id, scalar_var, n_dofs );</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;            CHKERRABORT(system.comm().get(),<a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>);</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;            <span class="comment">// In the SCALAR case, there are no other variables associate with the &quot;point&quot;</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;            <span class="comment">// the total number of dofs on the point is the same as that for the field</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;            ierr = PetscSectionSetDof( section, local_id, n_dofs );</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;            CHKERRABORT(system.comm().get(),<a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>);</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;          }</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;      }</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;  }</div>
<div class="ttc" id="mesh__communication_8C_html_afaa03b874c297f4693d9cdef7f50f3c6"><div class="ttname"><a href="mesh__communication_8C.html#afaa03b874c297f4693d9cdef7f50f3c6">mesh</a></div><div class="ttdeci">MeshBase &amp; mesh</div><div class="ttdef"><b>Definition:</b> <a href="mesh__communication_8C_source.html#l01308">mesh_communication.C:1308</a></div></div>
<div class="ttc" id="namespacelibMesh_html_a03d02ae8c0dab01091f6b27bd0765c7d"><div class="ttname"><a href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">libMesh::ierr</a></div><div class="ttdeci">PetscErrorCode PetscInt const PetscInt IS DM *subdm PetscErrorCode ierr</div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8C_source.html#l00061">petsc_dm_wrapper.C:61</a></div></div>
<div class="ttc" id="namespacelibMesh_html_a4f791f2cb1525c37e7916d564c3b3b78"><div class="ttname"><a href="namespacelibMesh.html#a4f791f2cb1525c37e7916d564c3b3b78">libMesh::libmesh_assert</a></div><div class="ttdeci">libmesh_assert(ctx)</div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_a740f44c588717f1ef575fd2bd3674fe8"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#a740f44c588717f1ef575fd2bd3674fe8">libMesh::PetscDMWrapper::add_dofs_helper</a></div><div class="ttdeci">void add_dofs_helper(const System &amp;system, const DofObject &amp;dof_object, dof_id_type local_id, PetscSection &amp;section)</div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8C_source.html#l01019">petsc_dm_wrapper.C:1019</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af9ebb64f4d3f5f353f91ac2fcbe6a198"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void libMesh::PetscDMWrapper::build_section </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlibMesh_1_1System.html">System</a> &amp;&#160;</td>
          <td class="paramname"><em>system</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscSection &amp;&#160;</td>
          <td class="paramname"><em>section</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Takes <a class="el" href="classlibMesh_1_1System.html" title="Manages consistently variables, degrees of freedom, and coefficient vectors. ">System</a>, empty PetscSection and populates the PetscSection. </p>
<p>Take the <a class="el" href="classlibMesh_1_1System.html" title="Manages consistently variables, degrees of freedom, and coefficient vectors. ">System</a> in its current state and an empty PetscSection and then populate the PetscSection. The PetscSection is comprised of global "point" numbers, where a "point" in PetscDM parlance is a geometric entity: node, edge, face, or element. Then, we also add the DoF numbering for each variable for each of the "points". The PetscSection, together the with PetscSF will allow for recursive fieldsplits from the command line using PETSc. </p>

<p>在文件 <a class="el" href="petsc__dm__wrapper_8C_source.html">petsc_dm_wrapper.C</a> 第 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00713">713</a> 行定义.</p>

<p>参考 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00961">add_dofs_to_section()</a>, <a class="el" href="petsc__dm__wrapper_8C_source.html#l01052">check_section_n_dofs()</a>, <a class="el" href="parallel__object_8h_source.html#l00097">libMesh::ParallelObject::comm()</a>, <a class="el" href="petsc__dm__wrapper_8C_source.html#l00061">libMesh::ierr</a>, <a class="el" href="int__range_8h_source.html#l00134">libMesh::make_range()</a>, <a class="el" href="system_8C_source.html#l00149">libMesh::System::n_local_dofs()</a>, <a class="el" href="system_8h_source.html#l02349">libMesh::System::n_vars()</a>, <a class="el" href="libmesh_8C_source.html#l00872">libMesh::on_command_line()</a>, <a class="el" href="petsc__dm__wrapper_8C_source.html#l00846">set_point_range_in_section()</a> , 以及 <a class="el" href="system_8h_source.html#l02397">libMesh::System::variable_name()</a>.</p>

<p>参考自 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00451">init_and_attach_petscdm()</a>.</p>
<div class="fragment"><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  {</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    LOG_SCOPE (<span class="stringliteral">&quot;build_section()&quot;</span>, <span class="stringliteral">&quot;PetscDMWrapper&quot;</span>);</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    PetscErrorCode <a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    ierr = PetscSectionCreate(system.comm().get(),&amp;section);</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    CHKERRABORT(system.comm().get(),<a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>);</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="comment">// Tell the PetscSection about all of our System variables</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    ierr = PetscSectionSetNumFields(section,system.n_vars());</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    CHKERRABORT(system.comm().get(),<a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>);</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="comment">// Set the actual names of all the field variables</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> v : <a class="code" href="namespacelibMesh.html#a18dea64f5cc7fa12c864d7571bb69d0b">make_range</a>(system.n_vars()))</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      {</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        ierr = PetscSectionSetFieldName( section, v, system.variable_name(v).c_str() );</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        CHKERRABORT(system.comm().get(),<a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>);</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      }</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <span class="comment">// For building the section, we need to create local-to-global map</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="comment">// of local &quot;point&quot; ids to the libMesh global id of that point.</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="comment">// A &quot;point&quot; in PETSc nomenclature is a geometric object that can have</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <span class="comment">// dofs associated with it, e.g. Node, Edge, Face, Elem.</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="comment">// The numbering PETSc expects is continuous for the local numbering.</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="comment">// Since we&#39;re only using this interface for solvers, then we can just</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <span class="comment">// assign whatever local id to any of the global ids. But it is local</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="comment">// so we don&#39;t need to worry about processor numbering for the local</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="comment">// point ids.</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    std::unordered_map&lt;dof_id_type,dof_id_type&gt; node_map;</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    std::unordered_map&lt;dof_id_type,dof_id_type&gt; elem_map;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    std::map&lt;dof_id_type,unsigned int&gt; scalar_map;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="comment">// First we tell the PetscSection about all of our points that have</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <span class="comment">// dofs associated with them.</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    this-&gt;<a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a6f5911ff56027bac98ee7000d81ab3c2">set_point_range_in_section</a>(system, section, node_map, elem_map, scalar_map);</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <span class="comment">// Now we can build up the dofs per &quot;point&quot; in the PetscSection</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    this-&gt;<a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a4cab51fa93c6f9253c31726ac0806755">add_dofs_to_section</a>(system, section, node_map, elem_map, scalar_map);</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <span class="comment">// Final setup of PetscSection</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <span class="comment">// Until Matt Knepley finishes implementing the commented out function</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="comment">// below, the PetscSection will be assuming node-major ordering</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <span class="comment">// so let&#39;s throw an error if the user tries to use this without</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="comment">// node-major order</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    libmesh_error_msg_if(!<a class="code" href="namespacelibMesh.html#adc9fb0dafe70b50cd0848a8142cf57c0">libMesh::on_command_line</a>(<span class="stringliteral">&quot;--node-major-dofs&quot;</span>),</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                         <span class="stringliteral">&quot;ERROR: Must use --node-major-dofs with PetscSection!&quot;</span>);</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <span class="comment">//else if (!system.identify_variable_groups())</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="comment">//  ierr = PetscSectionSetUseFieldOffsets(section,PETSC_TRUE);LIBMESH_CHKERR(ierr);</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="comment">//else</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    <span class="comment">//  {</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <span class="comment">//    std::string msg = &quot;ERROR: Only node-major or var-major ordering supported for PetscSection!\n&quot;;</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="comment">//    msg += &quot;       var-group-major ordering not supported!\n&quot;;</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="comment">//    msg += &quot;       Must use --node-major-dofs or set System::identify_variable_groups() = false!\n&quot;;</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="comment">//    libmesh_error_msg(msg);</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="comment">//  }</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    ierr = PetscSectionSetUp(section);</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    CHKERRABORT(system.comm().get(),<a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>);</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <span class="comment">// Sanity checking at least that local_n_dofs match</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    libmesh_assert_equal_to(system.n_local_dofs(),this-&gt;<a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a8d41770849fa0210d915d9644de9f176">check_section_n_dofs</a>(section));</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  }</div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_a8d41770849fa0210d915d9644de9f176"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#a8d41770849fa0210d915d9644de9f176">libMesh::PetscDMWrapper::check_section_n_dofs</a></div><div class="ttdeci">dof_id_type check_section_n_dofs(PetscSection &amp;section)</div><div class="ttdoc">Helper function to sanity check PetscSection construction The PetscSection contains local dof informa...</div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8C_source.html#l01052">petsc_dm_wrapper.C:1052</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_a6f5911ff56027bac98ee7000d81ab3c2"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#a6f5911ff56027bac98ee7000d81ab3c2">libMesh::PetscDMWrapper::set_point_range_in_section</a></div><div class="ttdeci">void set_point_range_in_section(const System &amp;system, PetscSection &amp;section, std::unordered_map&lt; dof_id_type, dof_id_type &gt; &amp;node_map, std::unordered_map&lt; dof_id_type, dof_id_type &gt; &amp;elem_map, std::map&lt; dof_id_type, unsigned int &gt; &amp;scalar_map)</div><div class="ttdoc">Helper function for build_section. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8C_source.html#l00846">petsc_dm_wrapper.C:846</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_a4cab51fa93c6f9253c31726ac0806755"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#a4cab51fa93c6f9253c31726ac0806755">libMesh::PetscDMWrapper::add_dofs_to_section</a></div><div class="ttdeci">void add_dofs_to_section(const System &amp;system, PetscSection &amp;section, const std::unordered_map&lt; dof_id_type, dof_id_type &gt; &amp;node_map, const std::unordered_map&lt; dof_id_type, dof_id_type &gt; &amp;elem_map, const std::map&lt; dof_id_type, unsigned int &gt; &amp;scalar_map)</div><div class="ttdoc">Helper function for build_section. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8C_source.html#l00961">petsc_dm_wrapper.C:961</a></div></div>
<div class="ttc" id="namespacelibMesh_html_a03d02ae8c0dab01091f6b27bd0765c7d"><div class="ttname"><a href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">libMesh::ierr</a></div><div class="ttdeci">PetscErrorCode PetscInt const PetscInt IS DM *subdm PetscErrorCode ierr</div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8C_source.html#l00061">petsc_dm_wrapper.C:61</a></div></div>
<div class="ttc" id="namespacelibMesh_html_a18dea64f5cc7fa12c864d7571bb69d0b"><div class="ttname"><a href="namespacelibMesh.html#a18dea64f5cc7fa12c864d7571bb69d0b">libMesh::make_range</a></div><div class="ttdeci">IntRange&lt; T &gt; make_range(T beg, T end)</div><div class="ttdoc">The 2-parameter make_range() helper function returns an IntRange&amp;lt;T&amp;gt; when both input parameters are of...</div><div class="ttdef"><b>Definition:</b> <a href="int__range_8h_source.html#l00134">int_range.h:134</a></div></div>
<div class="ttc" id="namespacelibMesh_html_adc9fb0dafe70b50cd0848a8142cf57c0"><div class="ttname"><a href="namespacelibMesh.html#adc9fb0dafe70b50cd0848a8142cf57c0">libMesh::on_command_line</a></div><div class="ttdeci">bool on_command_line(std::string arg)</div><div class="ttdef"><b>Definition:</b> <a href="libmesh_8C_source.html#l00872">libmesh.C:872</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab9a1fd9620e6cbef319c215a7341e8d4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void libMesh::PetscDMWrapper::build_sf </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlibMesh_1_1System.html">System</a> &amp;&#160;</td>
          <td class="paramname"><em>system</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscSF &amp;&#160;</td>
          <td class="paramname"><em>star_forest</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Takes <a class="el" href="classlibMesh_1_1System.html" title="Manages consistently variables, degrees of freedom, and coefficient vectors. ">System</a>, empty PetscSF and populates the PetscSF. </p>
<p>The PetscSF (star forest) is a cousin of PetscSection. PetscSection has the DoF info, and PetscSF gives the parallel distribution of the DoF info. So PetscSF should only be necessary when we have more than one MPI rank. Essentially, we are copying the DofMap.send_list(): we are specifying the local dofs, what rank communicates that dof info (for off-processor dofs that are communicated) and the dofs local index on that rank.</p>
<p><a href="https://jedbrown.org/files/StarForest.pdf">https://jedbrown.org/files/StarForest.pdf</a> </p>

<p>在文件 <a class="el" href="petsc__dm__wrapper_8C_source.html">petsc_dm_wrapper.C</a> 第 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00777">777</a> 行定义.</p>

<p>参考 <a class="el" href="parallel__object_8h_source.html#l00097">libMesh::ParallelObject::comm()</a>, <a class="el" href="dof__map_8h_source.html#l00717">libMesh::DofMap::dof_owner()</a>, <a class="el" href="dof__map_8h_source.html#l00684">libMesh::DofMap::first_dof()</a>, <a class="el" href="system_8h_source.html#l02293">libMesh::System::get_dof_map()</a>, <a class="el" href="dof__map_8h_source.html#l00511">libMesh::DofMap::get_send_list()</a>, <a class="el" href="petsc__dm__wrapper_8C_source.html#l00061">libMesh::ierr</a>, <a class="el" href="int__range_8h_source.html#l00111">libMesh::index_range()</a> , 以及 <a class="el" href="dof__map_8h_source.html#l00669">libMesh::DofMap::n_local_dofs()</a>.</p>

<p>参考自 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00451">init_and_attach_petscdm()</a>.</p>
<div class="fragment"><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  {</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    LOG_SCOPE (<span class="stringliteral">&quot;build_sf()&quot;</span>, <span class="stringliteral">&quot;PetscDMWrapper&quot;</span>);</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <span class="keyword">const</span> DofMap &amp; dof_map = system.get_dof_map();</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keyword">const</span> std::vector&lt;dof_id_type&gt; &amp; send_list = dof_map.get_send_list();</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <span class="comment">// Number of ghost dofs that send information to this processor</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="keyword">const</span> PetscInt n_leaves = cast_int&lt;PetscInt&gt;(send_list.size());</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="comment">// Number of local dofs, including ghosts dofs</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="keyword">const</span> PetscInt n_roots = dof_map.n_local_dofs() + n_leaves;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="comment">// This is the vector of dof indices coming from other processors</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="comment">// We need to give this to the PetscSF</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="comment">// We&#39;ll be extra paranoid about this ugly double cast</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    static_assert(<span class="keyword">sizeof</span>(PetscInt) == <span class="keyword">sizeof</span>(<a class="code" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a>),<span class="stringliteral">&quot;PetscInt is not a dof_id_type!&quot;</span>);</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    PetscInt * local_dofs = <span class="keyword">reinterpret_cast&lt;</span>PetscInt *<span class="keyword">&gt;</span>(<span class="keyword">const_cast&lt;</span><a class="code" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a> *<span class="keyword">&gt;</span>(send_list.data()));</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="preprocessor"></span>    <span class="comment">// PETSc 3.18 and above don&#39;t want duplicate entries here ... and</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="comment">// frankly we shouldn&#39;t have duplicates in the first place!</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    {</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;      std::set&lt;dof_id_type&gt; send_set(send_list.begin(), send_list.end());</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;      libmesh_assert_equal_to(send_list.size(), send_set.size());</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    }</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="comment">// This is the vector of PetscSFNode&#39;s for the local_dofs.</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="comment">// For each entry in local_dof, we have to supply the rank from which</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="comment">// that dof stems and its local index on that rank.</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <span class="comment">// PETSc documentation here:</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    <span class="comment">// http://www.mcs.anl.gov/petsc/petsc-current/docs/manualpages/PetscSF/PetscSFNode.html</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    std::vector&lt;PetscSFNode&gt; sf_nodes(send_list.size());</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> i : <a class="code" href="namespacelibMesh.html#a26e38c0dc87c05a5e8df7e26bfed543b">index_range</a>(send_list))</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;      {</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        <a class="code" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a> incoming_dof = send_list[i];</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacelibMesh.html#af18245d4f872c36a41fc74086bda3e80">processor_id_type</a> rank = dof_map.dof_owner(incoming_dof);</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        <span class="comment">// Dofs are sorted and continuous on the processor so local index</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;        <span class="comment">// is counted up from the first dof on the processor.</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        PetscInt index = incoming_dof - dof_map.first_dof(rank);</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        sf_nodes[i].rank  = rank; <span class="comment">/* Rank of owner */</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        sf_nodes[i].index = index;<span class="comment">/* Index of dof on rank */</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      }</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    PetscSFNode * remote_dofs = sf_nodes.data();</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    PetscErrorCode <a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    ierr = PetscSFCreate(system.comm().get(), &amp;star_forest);</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    CHKERRABORT(system.comm().get(),<a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>);</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <span class="comment">// TODO: We should create pointers to arrays so we don&#39;t have to copy</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="comment">//       and then can use PETSC_OWN_POINTER where PETSc will take ownership</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="comment">//       and delete the memory for us. But then we&#39;d have to use PetscMalloc.</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    ierr = PetscSFSetGraph(star_forest,</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;                           n_roots,</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;                           n_leaves,</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;                           local_dofs,</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;                           PETSC_COPY_VALUES,</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;                           remote_dofs,</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;                           PETSC_COPY_VALUES);</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    CHKERRABORT(system.comm().get(),<a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>);</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  }</div>
<div class="ttc" id="namespacelibMesh_html_a03d02ae8c0dab01091f6b27bd0765c7d"><div class="ttname"><a href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">libMesh::ierr</a></div><div class="ttdeci">PetscErrorCode PetscInt const PetscInt IS DM *subdm PetscErrorCode ierr</div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8C_source.html#l00061">petsc_dm_wrapper.C:61</a></div></div>
<div class="ttc" id="namespacelibMesh_html_af18245d4f872c36a41fc74086bda3e80"><div class="ttname"><a href="namespacelibMesh.html#af18245d4f872c36a41fc74086bda3e80">libMesh::processor_id_type</a></div><div class="ttdeci">uint8_t processor_id_type</div><div class="ttdef"><b>Definition:</b> <a href="id__types_8h_source.html#l00104">id_types.h:104</a></div></div>
<div class="ttc" id="namespacelibMesh_html_a26e38c0dc87c05a5e8df7e26bfed543b"><div class="ttname"><a href="namespacelibMesh.html#a26e38c0dc87c05a5e8df7e26bfed543b">libMesh::index_range</a></div><div class="ttdeci">auto index_range(const T &amp;sizable)</div><div class="ttdoc">Helper function that returns an IntRange&amp;lt;std::size_t&amp;gt; representing all the indices of the passed-in v...</div><div class="ttdef"><b>Definition:</b> <a href="int__range_8h_source.html#l00111">int_range.h:111</a></div></div>
<div class="ttc" id="namespacelibMesh_html_ab4541d74809228310a715b11c40587fc"><div class="ttname"><a href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">libMesh::dof_id_type</a></div><div class="ttdeci">uint8_t dof_id_type</div><div class="ttdef"><b>Definition:</b> <a href="id__types_8h_source.html#l00067">id_types.h:67</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8d41770849fa0210d915d9644de9f176"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a> libMesh::PetscDMWrapper::check_section_n_dofs </td>
          <td>(</td>
          <td class="paramtype">PetscSection &amp;&#160;</td>
          <td class="paramname"><em>section</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Helper function to sanity check PetscSection construction The PetscSection contains local dof information. </p>
<p>This helper function just facilitates sanity checking that in fact it only has n_local_dofs. </p>

<p>在文件 <a class="el" href="petsc__dm__wrapper_8C_source.html">petsc_dm_wrapper.C</a> 第 <a class="el" href="petsc__dm__wrapper_8C_source.html#l01052">1052</a> 行定义.</p>

<p>参考 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00061">libMesh::ierr</a>.</p>

<p>参考自 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00713">build_section()</a>.</p>
<div class="fragment"><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;  {</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    PetscInt n_local_dofs = 0;</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    <span class="comment">// Grap the starting and ending points from the section</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    PetscInt pstart, pend;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    PetscErrorCode <a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a> = PetscSectionGetChart(section, &amp;pstart, &amp;pend);</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    <span class="keywordflow">if</span> (ierr)</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;      libmesh_error();</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    <span class="comment">// Count up the n_dofs for each point from the section</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    <span class="keywordflow">for</span>( PetscInt p = pstart; p &lt; pend; p++ )</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;      {</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;        PetscInt n_dofs;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;        ierr = PetscSectionGetDof(section,p,&amp;n_dofs);</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;        <span class="keywordflow">if</span> (ierr)</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;          libmesh_error();</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        n_local_dofs += n_dofs;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      }</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    static_assert(<span class="keyword">sizeof</span>(PetscInt) == <span class="keyword">sizeof</span>(<a class="code" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a>),<span class="stringliteral">&quot;PetscInt is not a dof_id_type!&quot;</span>);</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    <span class="keywordflow">return</span> n_local_dofs;</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  }</div>
<div class="ttc" id="namespacelibMesh_html_a03d02ae8c0dab01091f6b27bd0765c7d"><div class="ttname"><a href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">libMesh::ierr</a></div><div class="ttdeci">PetscErrorCode PetscInt const PetscInt IS DM *subdm PetscErrorCode ierr</div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8C_source.html#l00061">petsc_dm_wrapper.C:61</a></div></div>
<div class="ttc" id="namespacelibMesh_html_ab4541d74809228310a715b11c40587fc"><div class="ttname"><a href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">libMesh::dof_id_type</a></div><div class="ttdeci">uint8_t dof_id_type</div><div class="ttdef"><b>Definition:</b> <a href="id__types_8h_source.html#l00067">id_types.h:67</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a89d3f9c0a20bdf40beb55266d17615ab"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void libMesh::PetscDMWrapper::clear </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Destroys and clears all build DM-related data. </p>

<p>在文件 <a class="el" href="petsc__dm__wrapper_8C_source.html">petsc_dm_wrapper.C</a> 第 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00430">430</a> 行定义.</p>

<p>参考 <a class="el" href="petsc__dm__wrapper_8h_source.html#l00157">_ctx_vec</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00117">_dms</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00170">_mesh_dof_loc_sizes</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00167">_mesh_dof_sizes</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00143">_pmtx_vec</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00127">_sections</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00136">_star_forests</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00150">_subpmtx_vec</a> , 以及 <a class="el" href="petsc__dm__wrapper_8h_source.html#l00164">_vec_vec</a>.</p>

<p>参考自 <a class="el" href="petsc__diff__solver_8C_source.html#l00211">libMesh::PetscDiffSolver::clear()</a>.</p>
<div class="fragment"><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  {</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="comment">// Calls custom deleters</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa4d26a0e9269059e4e3436368ed29060">_dms</a>.clear();</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a7b64223ac3403b535b0d687825aa16b1">_sections</a>.clear();</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="comment">// We don&#39;t manage the lifetime of the PetscSF objects</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a8258edc20f6aa9603bc0ee44cd98132b">_star_forests</a>.clear();</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="comment">// The relevant C++ destructors are called for these objects</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="comment">// automatically.</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a8db0313aa38a2acc547b5fefaac50027">_pmtx_vec</a>.clear();</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a2e8ca5ec9955c8f2a2813ca8a70c922e">_subpmtx_vec</a>.clear();</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a5d2cb2619787d5e29185d720bf5d74f1">_vec_vec</a>.clear();</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="comment">// These members are trivially clear()able.</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">_ctx_vec</a>.clear();</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#ade81e2a381216f2d8ba1be473e46fc30">_mesh_dof_sizes</a>.clear();</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#ad236a8053fde71cf4344bc02c8af40a9">_mesh_dof_loc_sizes</a>.clear();</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  }</div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_a5d2cb2619787d5e29185d720bf5d74f1"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#a5d2cb2619787d5e29185d720bf5d74f1">libMesh::PetscDMWrapper::_vec_vec</a></div><div class="ttdeci">std::vector&lt; std::unique_ptr&lt; PetscVector&lt; Number &gt; &gt; &gt; _vec_vec</div><div class="ttdoc">Vector of solution vectors for all grid levels. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00164">petsc_dm_wrapper.h:164</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_aa29b614c713146bf8be8dc066ac4cdc3"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">libMesh::PetscDMWrapper::_ctx_vec</a></div><div class="ttdeci">std::vector&lt; PetscDMContext &gt; _ctx_vec</div><div class="ttdoc">Vector of internal PetscDM context structs for all grid levels Pointers to these C++ objects are pass...</div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00157">petsc_dm_wrapper.h:157</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_aa4d26a0e9269059e4e3436368ed29060"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#aa4d26a0e9269059e4e3436368ed29060">libMesh::PetscDMWrapper::_dms</a></div><div class="ttdeci">std::vector&lt; WrappedPetsc&lt; DM &gt; &gt; _dms</div><div class="ttdoc">Vector of DMs for all grid levels. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00117">petsc_dm_wrapper.h:117</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_a8db0313aa38a2acc547b5fefaac50027"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#a8db0313aa38a2acc547b5fefaac50027">libMesh::PetscDMWrapper::_pmtx_vec</a></div><div class="ttdeci">std::vector&lt; std::unique_ptr&lt; PetscMatrix&lt; Number &gt; &gt; &gt; _pmtx_vec</div><div class="ttdoc">Vector of projection matrixes for all grid levels. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00143">petsc_dm_wrapper.h:143</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_a2e8ca5ec9955c8f2a2813ca8a70c922e"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#a2e8ca5ec9955c8f2a2813ca8a70c922e">libMesh::PetscDMWrapper::_subpmtx_vec</a></div><div class="ttdeci">std::vector&lt; std::unique_ptr&lt; PetscMatrix&lt; Number &gt; &gt; &gt; _subpmtx_vec</div><div class="ttdoc">Vector of sub projection matrixes for all grid levels for fieldsplit. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00150">petsc_dm_wrapper.h:150</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_a7b64223ac3403b535b0d687825aa16b1"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#a7b64223ac3403b535b0d687825aa16b1">libMesh::PetscDMWrapper::_sections</a></div><div class="ttdeci">std::vector&lt; WrappedPetsc&lt; PetscSection &gt; &gt; _sections</div><div class="ttdoc">Vector of PETScSections for all grid levels. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00127">petsc_dm_wrapper.h:127</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_ad236a8053fde71cf4344bc02c8af40a9"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#ad236a8053fde71cf4344bc02c8af40a9">libMesh::PetscDMWrapper::_mesh_dof_loc_sizes</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; _mesh_dof_loc_sizes</div><div class="ttdoc">Stores n_local_dofs for each grid level, to be used for projection vector sizing. ...</div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00170">petsc_dm_wrapper.h:170</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_a8258edc20f6aa9603bc0ee44cd98132b"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#a8258edc20f6aa9603bc0ee44cd98132b">libMesh::PetscDMWrapper::_star_forests</a></div><div class="ttdeci">std::vector&lt; PetscSF &gt; _star_forests</div><div class="ttdoc">Vector of star forests for all grid levels. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00136">petsc_dm_wrapper.h:136</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_ade81e2a381216f2d8ba1be473e46fc30"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#ade81e2a381216f2d8ba1be473e46fc30">libMesh::PetscDMWrapper::_mesh_dof_sizes</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; _mesh_dof_sizes</div><div class="ttdoc">Stores n_dofs for each grid level, to be used for projection matrix sizing. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00167">petsc_dm_wrapper.h:167</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a34bd5c1fa064d2c382a52607f4465c8f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">DM&amp; libMesh::PetscDMWrapper::get_dm </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>level</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get reference to DM for the given mesh level. </p>
<p><a class="el" href="classlibMesh_1_1PetscDMWrapper.html#a2d70713d86345846096c6ef22258cf14" title="Init all the n_mesh_level dependent data structures. ">init_dm_data()</a> should be called before this function. </p>

<p>在文件 <a class="el" href="petsc__dm__wrapper_8h_source.html">petsc_dm_wrapper.h</a> 第 <a class="el" href="petsc__dm__wrapper_8h_source.html#l00179">179</a> 行定义.</p>

<p>参考 <a class="el" href="petsc__dm__wrapper_8h_source.html#l00117">_dms</a>.</p>

<p>参考自 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00451">init_and_attach_petscdm()</a>.</p>
<div class="fragment"><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      { libmesh_assert_less(level, <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa4d26a0e9269059e4e3436368ed29060">_dms</a>.size());</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="keywordflow">return</span> *<a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa4d26a0e9269059e4e3436368ed29060">_dms</a>[level]; }</div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_aa4d26a0e9269059e4e3436368ed29060"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#aa4d26a0e9269059e4e3436368ed29060">libMesh::PetscDMWrapper::_dms</a></div><div class="ttdeci">std::vector&lt; WrappedPetsc&lt; DM &gt; &gt; _dms</div><div class="ttdoc">Vector of DMs for all grid levels. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00117">petsc_dm_wrapper.h:117</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6295b51ea21d5501420c2c171ac0afa6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">PetscSection&amp; libMesh::PetscDMWrapper::get_section </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>level</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get reference to PetscSection for the given mesh level. </p>
<p><a class="el" href="classlibMesh_1_1PetscDMWrapper.html#a2d70713d86345846096c6ef22258cf14" title="Init all the n_mesh_level dependent data structures. ">init_dm_data()</a> should be called before this function. </p>

<p>在文件 <a class="el" href="petsc__dm__wrapper_8h_source.html">petsc_dm_wrapper.h</a> 第 <a class="el" href="petsc__dm__wrapper_8h_source.html#l00187">187</a> 行定义.</p>

<p>参考 <a class="el" href="petsc__dm__wrapper_8h_source.html#l00127">_sections</a>.</p>

<p>参考自 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00451">init_and_attach_petscdm()</a>.</p>
<div class="fragment"><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      { libmesh_assert_less(level, <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a7b64223ac3403b535b0d687825aa16b1">_sections</a>.size());</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <span class="keywordflow">return</span> *<a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a7b64223ac3403b535b0d687825aa16b1">_sections</a>[level]; }</div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_a7b64223ac3403b535b0d687825aa16b1"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#a7b64223ac3403b535b0d687825aa16b1">libMesh::PetscDMWrapper::_sections</a></div><div class="ttdeci">std::vector&lt; WrappedPetsc&lt; PetscSection &gt; &gt; _sections</div><div class="ttdoc">Vector of PETScSections for all grid levels. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00127">petsc_dm_wrapper.h:127</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aed2e29d969ca4c92ed1770477aa1a7ba"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">PetscSF&amp; libMesh::PetscDMWrapper::get_star_forest </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>level</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get reference to PetscSF for the given mesh level. </p>
<p><a class="el" href="classlibMesh_1_1PetscDMWrapper.html#a2d70713d86345846096c6ef22258cf14" title="Init all the n_mesh_level dependent data structures. ">init_dm_data()</a> should be called before this function. </p>

<p>在文件 <a class="el" href="petsc__dm__wrapper_8h_source.html">petsc_dm_wrapper.h</a> 第 <a class="el" href="petsc__dm__wrapper_8h_source.html#l00195">195</a> 行定义.</p>

<p>参考 <a class="el" href="petsc__dm__wrapper_8h_source.html#l00136">_star_forests</a>.</p>

<p>参考自 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00451">init_and_attach_petscdm()</a>.</p>
<div class="fragment"><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      { libmesh_assert_less(level, <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a8258edc20f6aa9603bc0ee44cd98132b">_star_forests</a>.size());</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a8258edc20f6aa9603bc0ee44cd98132b">_star_forests</a>[level]; }</div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_a8258edc20f6aa9603bc0ee44cd98132b"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#a8258edc20f6aa9603bc0ee44cd98132b">libMesh::PetscDMWrapper::_star_forests</a></div><div class="ttdeci">std::vector&lt; PetscSF &gt; _star_forests</div><div class="ttdoc">Vector of star forests for all grid levels. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00136">petsc_dm_wrapper.h:136</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2df0375f2aafe4f68ddb9276ce76798e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void libMesh::PetscDMWrapper::init_and_attach_petscdm </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlibMesh_1_1System.html">System</a> &amp;&#160;</td>
          <td class="paramname"><em>system</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SNES &amp;&#160;</td>
          <td class="paramname"><em>snes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>在文件 <a class="el" href="petsc__dm__wrapper_8C_source.html">petsc_dm_wrapper.C</a> 第 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00451">451</a> 行定义.</p>

<p>参考 <a class="el" href="petsc__dm__wrapper_8h_source.html#l00157">_ctx_vec</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00117">_dms</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00170">_mesh_dof_loc_sizes</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00167">_mesh_dof_sizes</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00143">_pmtx_vec</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00150">_subpmtx_vec</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00164">_vec_vec</a>, <a class="el" href="mesh__base_8h_source.html#l01185">libMesh::MeshBase::allow_remote_element_removal()</a>, <a class="el" href="mesh__base_8h_source.html#l01169">libMesh::MeshBase::allow_renumbering()</a>, <a class="el" href="petsc__dm__wrapper_8C_source.html#l00713">build_section()</a>, <a class="el" href="petsc__dm__wrapper_8C_source.html#l00777">build_sf()</a>, <a class="el" href="parallel__object_8h_source.html#l00097">libMesh::ParallelObject::comm()</a>, <a class="el" href="libmesh_8C_source.html#l00937">libMesh::command_line_next()</a>, <a class="el" href="classlibMesh_1_1MeshBase.html#a0a109c00dfc85ad16576fde8a0cb2215">libMesh::MeshBase::contract()</a>, <a class="el" href="dof__map_8C_source.html#l00927">libMesh::DofMap::distribute_dofs()</a>, <a class="el" href="dof__map_8h_source.html#l00731">libMesh::DofMap::end_old_dof()</a>, <a class="el" href="dof__map_8h_source.html#l00694">libMesh::DofMap::first_old_dof()</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00179">get_dm()</a>, <a class="el" href="system_8h_source.html#l02293">libMesh::System::get_dof_map()</a>, <a class="el" href="system_8h_source.html#l02277">libMesh::System::get_mesh()</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00187">get_section()</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00195">get_star_forest()</a>, <a class="el" href="petsc__dm__wrapper_8C_source.html#l00061">libMesh::ierr</a>, <a class="el" href="petsc__dm__wrapper_8C_source.html#l01076">init_dm_data()</a>, <a class="el" href="namespacelibMesh.html#a4f791f2cb1525c37e7916d564c3b3b78">libMesh::libmesh_assert()</a>, <a class="el" href="petsc__dm__wrapper_8C_source.html#l00222">libMesh::libmesh_petsc_DMCoarsen()</a>, <a class="el" href="petsc__dm__wrapper_8C_source.html#l00310">libMesh::libmesh_petsc_DMCreateInterpolation()</a>, <a class="el" href="petsc__dm__wrapper_8C_source.html#l00400">libMesh::libmesh_petsc_DMCreateRestriction()</a>, <a class="el" href="namespacelibMesh.html#a2643664981a6bdf371857274f11c13a0">libMesh::libmesh_petsc_DMCreateSubDM()</a>, <a class="el" href="petsc__dm__wrapper_8C_source.html#l00200">libMesh::libmesh_petsc_DMRefine()</a>, <a class="el" href="dof__map_8C_source.html#l01109">libMesh::DofMap::local_variable_indices()</a>, <a class="el" href="mesh__communication_8C_source.html#l01308">mesh</a>, <a class="el" href="mesh__base_8C_source.html#l00322">libMesh::MeshBase::mesh_dimension()</a>, <a class="el" href="dof__map_8h_source.html#l00659">libMesh::DofMap::n_dofs()</a>, <a class="el" href="dof__map_8h_source.html#l00675">libMesh::DofMap::n_dofs_on_processor()</a>, <a class="el" href="mesh__tools_8C_source.html#l00801">libMesh::MeshTools::n_levels()</a>, <a class="el" href="dof__map_8h_source.html#l00669">libMesh::DofMap::n_local_dofs()</a>, <a class="el" href="parallel__object_8h_source.html#l00103">libMesh::ParallelObject::n_processors()</a>, <a class="el" href="tecplot__io_8C_source.html#l00068">n_vars</a>, <a class="el" href="system_8h_source.html#l02349">libMesh::System::n_vars()</a>, <a class="el" href="mesh__base_8h_source.html#l00150">libMesh::MeshBase::partitioner()</a>, <a class="el" href="dof__map_8C_source.html#l01692">libMesh::DofMap::prepare_send_list()</a>, <a class="el" href="parallel__object_8h_source.html#l00114">libMesh::ParallelObject::processor_id()</a>, <a class="el" href="system__projection_8C_source.html#l00952">libMesh::System::projection_matrix()</a>, <a class="el" href="system_8C_source.html#l00479">libMesh::System::reinit_constraints()</a>, <a class="el" href="mesh__refinement_8C_source.html#l01709">libMesh::MeshRefinement::uniformly_coarsen()</a> , 以及 <a class="el" href="mesh__refinement_8C_source.html#l01684">libMesh::MeshRefinement::uniformly_refine()</a>.</p>

<p>参考自 <a class="el" href="petsc__diff__solver_8C_source.html#l00342">libMesh::PetscDiffSolver::setup_petsc_data()</a>.</p>
<div class="fragment"><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  {</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    LOG_SCOPE (<span class="stringliteral">&quot;init_and_attach_petscdm()&quot;</span>, <span class="stringliteral">&quot;PetscDMWrapper&quot;</span>);</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    PetscErrorCode <a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    MeshBase &amp; <a class="code" href="mesh__communication_8C.html#afaa03b874c297f4693d9cdef7f50f3c6">mesh</a> = system.get_mesh();   <span class="comment">// Convenience</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    MeshRefinement mesh_refinement(mesh); <span class="comment">// Used for swapping between grids</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="comment">// There&#39;s no need for these code paths while traversing the hierarchy</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    mesh.allow_renumbering(<span class="keyword">false</span>);</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    mesh.allow_remote_element_removal(<span class="keyword">false</span>);</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    mesh.partitioner() = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="comment">// First walk over the active local elements and see how many maximum MG levels we can construct</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">    unsigned int n_levels = 0;</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">    for ( auto &amp; elem : mesh.active_local_element_ptr_range() )</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">      {</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">        if ( elem-&gt;level() &gt; n_levels )</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">          n_levels = elem-&gt;level();</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">      }</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment">    // On coarse grids some processors may have no active local elements,</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">    // these processors shouldn&#39;t make projections</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">    if (n_levels &gt;= 1)</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">      n_levels += 1;</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespacelibMesh_1_1MeshTools.html#ae15ece869d4ef3d283edb677942e8439">n_levels</a> = <a class="code" href="namespacelibMesh_1_1MeshTools.html#ae15ece869d4ef3d283edb677942e8439">MeshTools::n_levels</a>(mesh);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="comment">// How many MG levels did the user request?</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> usr_requested_mg_lvls = 0;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    usr_requested_mg_lvls = <a class="code" href="namespacelibMesh.html#a7e1c5da5a247e5c99321c2eac5776615">command_line_next</a>(<span class="stringliteral">&quot;-pc_mg_levels&quot;</span>, usr_requested_mg_lvls);</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="comment">// Only construct however many levels were requested if something was actually requested</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordflow">if</span> ( usr_requested_mg_lvls != 0 )</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      {</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        <span class="comment">// Dont request more than avail num levels on mesh, require at least 2 levels</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        libmesh_assert_less_equal( usr_requested_mg_lvls, n_levels );</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <a class="code" href="namespacelibMesh.html#a4f791f2cb1525c37e7916d564c3b3b78">libmesh_assert</a>( usr_requested_mg_lvls &gt; 1 );</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        n_levels = usr_requested_mg_lvls;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      }</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <span class="comment">// if -pc_mg_levels is not specified we just construct fieldsplit related</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <span class="comment">// structures on the finest mesh.</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        n_levels = 1;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;      }</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="comment">// Init data structures: data[0] ~ coarse grid, data[n_levels-1] ~ fine grid</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    this-&gt;<a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a2d70713d86345846096c6ef22258cf14">init_dm_data</a>(n_levels, system.comm());</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="comment">// Step 1.  contract : all active elements have no children</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    mesh.contract();</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="comment">// Start on finest grid. Construct DM datas and stash some info for</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="comment">// later projection_matrix and vec sizing</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> level = n_levels; level &gt;= 1; level--)</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      {</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="comment">// Save the n_fine_dofs before coarsening for later projection matrix sizing</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#ade81e2a381216f2d8ba1be473e46fc30">_mesh_dof_sizes</a>[level-1] = system.get_dof_map().n_dofs();</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#ad236a8053fde71cf4344bc02c8af40a9">_mesh_dof_loc_sizes</a>[level-1] = system.get_dof_map().n_local_dofs();</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        <span class="comment">// Get refs to things we will fill</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        DM &amp; dm = this-&gt;<a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a34bd5c1fa064d2c382a52607f4465c8f">get_dm</a>(level-1);</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        PetscSection &amp; section = this-&gt;<a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a6295b51ea21d5501420c2c171ac0afa6">get_section</a>(level-1);</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        PetscSF &amp; star_forest = this-&gt;<a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aed2e29d969ca4c92ed1770477aa1a7ba">get_star_forest</a>(level-1);</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        <span class="comment">// The shell will contain other DM info</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        ierr = DMShellCreate(system.comm().get(), &amp;dm);</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        CHKERRABORT(system.comm().get(),<a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        <span class="comment">// Set the DM embedding dimension to help PetscDS (Discrete System)</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        ierr = DMSetCoordinateDim(dm, mesh.mesh_dimension());</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        CHKERRABORT(system.comm().get(),<a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>);</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <span class="comment">// Build the PetscSection and attach it to the DM</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        this-&gt;<a class="code" href="classlibMesh_1_1PetscDMWrapper.html#af9ebb64f4d3f5f353f91ac2fcbe6a198">build_section</a>(system, section);</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="preprocessor">#if PETSC_VERSION_LESS_THAN(3,10,0)</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="preprocessor"></span>        ierr = DMSetDefaultSection(dm, section);</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="preprocessor"></span>        ierr = DMSetSection(dm, section);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="preprocessor"></span>        CHKERRABORT(system.comm().get(),<a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>);</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        <span class="comment">// We only need to build the star forest if we&#39;re in a parallel environment</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        <span class="keywordflow">if</span> (system.n_processors() &gt; 1)</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;          {</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            <span class="comment">// Build the PetscSF and attach it to the DM</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            this-&gt;<a class="code" href="classlibMesh_1_1PetscDMWrapper.html#ab9a1fd9620e6cbef319c215a7341e8d4">build_sf</a>(system, star_forest);</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="preprocessor">#if PETSC_VERSION_LESS_THAN(3,12,0)</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="preprocessor"></span>            ierr = DMSetDefaultSF(dm, star_forest);</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="preprocessor"></span>            ierr = DMSetSectionSF(dm, star_forest);</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="preprocessor"></span>            CHKERRABORT(system.comm().get(),<a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>);</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;          }</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        <span class="comment">// Set PETSC&#39;s Restriction, Interpolation, Coarsen and Refine functions for the current DM</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        ierr = DMShellSetCreateInterpolation ( dm, <a class="code" href="namespacelibMesh.html#acd02afd327990a8dc4975602e404d618">libmesh_petsc_DMCreateInterpolation</a> );</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        CHKERRABORT(system.comm().get(),<a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>);</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        <span class="comment">// Not implemented. For now we rely on galerkin style restrictions</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        <span class="keywordtype">bool</span> supply_restriction = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <span class="keywordflow">if</span> (supply_restriction)</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;          {</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            ierr = DMShellSetCreateRestriction ( dm, <a class="code" href="namespacelibMesh.html#a2809ca711cb1f94c66ad00f235dec854">libmesh_petsc_DMCreateRestriction</a>  );</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;            CHKERRABORT(system.comm().get(),<a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>);</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;          }</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        ierr = DMShellSetCoarsen ( dm, <a class="code" href="namespacelibMesh.html#ad8f92d1a48957948f414ad82d8e9f8f8">libmesh_petsc_DMCoarsen</a> );</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        CHKERRABORT(system.comm().get(),<a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>);</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        ierr = DMShellSetRefine ( dm, <a class="code" href="namespacelibMesh.html#a2511fc6b42db0db246617a34c8771a01">libmesh_petsc_DMRefine</a> );</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        CHKERRABORT(system.comm().get(),<a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>);</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        ierr= DMShellSetCreateSubDM(dm, <a class="code" href="namespacelibMesh.html#a2643664981a6bdf371857274f11c13a0">libmesh_petsc_DMCreateSubDM</a>);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        CHKERRABORT(system.comm().get(), <a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>);</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <span class="comment">// Uniformly coarsen if not the coarsest grid and distribute dof info.</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        <span class="keywordflow">if</span> ( level != 1 )</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;          {</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;            LOG_CALL(<span class="stringliteral">&quot;PDM_coarsen&quot;</span>, <span class="stringliteral">&quot;PetscDMWrapper&quot;</span>, mesh_refinement.uniformly_coarsen(1));</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            LOG_CALL(<span class="stringliteral">&quot;PDM_dist_dof&quot;</span>, <span class="stringliteral">&quot;PetscDMWrapper&quot;</span>, system.get_dof_map().distribute_dofs(mesh));</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            LOG_CALL(<span class="stringliteral">&quot;PDM_prep_send&quot;</span>, <span class="stringliteral">&quot;PetscDMWrapper&quot;</span>, system.get_dof_map().prepare_send_list());</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;          }</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      } <span class="comment">// End PETSc data structure creation</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="comment">// Now fill the corresponding internal PetscDMContext for each created DM</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=1; i &lt;= <a class="code" href="namespacelibMesh_1_1MeshTools.html#ae15ece869d4ef3d283edb677942e8439">n_levels</a>; i++ )</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      {</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        <span class="comment">// Set context dimension</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">_ctx_vec</a>[i-1].mesh_dim = mesh.mesh_dimension();</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        <span class="comment">// Create and attach a sized vector to the current ctx</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a5d2cb2619787d5e29185d720bf5d74f1">_vec_vec</a>[i-1]-&gt;init( <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#ade81e2a381216f2d8ba1be473e46fc30">_mesh_dof_sizes</a>[i-1] );</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">_ctx_vec</a>[i-1].current_vec = <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a5d2cb2619787d5e29185d720bf5d74f1">_vec_vec</a>[i-1].get();</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        <span class="comment">// Set a global DM to be used as reference when using fieldsplit</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">_ctx_vec</a>[i-1].global_dm = &amp;(this-&gt;<a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a34bd5c1fa064d2c382a52607f4465c8f">get_dm</a>(n_levels-1));</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <span class="keywordflow">if</span> (n_levels &gt; 1 )</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;          {</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;            <span class="comment">// Set pointers to surrounding dm levels to help PETSc refine/coarsen</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            <span class="keywordflow">if</span> ( i == 1 ) <span class="comment">// were at the coarsest mesh</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;              {</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">_ctx_vec</a>[i-1].coarser_dm = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">_ctx_vec</a>[i-1].finer_dm   = <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa4d26a0e9269059e4e3436368ed29060">_dms</a>[1].get();</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;              }</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>( i == n_levels ) <span class="comment">// were at the finest mesh</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;              {</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">_ctx_vec</a>[i-1].coarser_dm = <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa4d26a0e9269059e4e3436368ed29060">_dms</a>[<a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa4d26a0e9269059e4e3436368ed29060">_dms</a>.size() - 2].get();</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">_ctx_vec</a>[i-1].finer_dm   = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;              }</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;            <span class="keywordflow">else</span> <span class="comment">// were in the middle of the hierarchy</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;              {</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">_ctx_vec</a>[i-1].coarser_dm = <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa4d26a0e9269059e4e3436368ed29060">_dms</a>[i-2].get();</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">_ctx_vec</a>[i-1].finer_dm   = <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa4d26a0e9269059e4e3436368ed29060">_dms</a>[i].get();</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;              }</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;          }</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      } <span class="comment">// End context creation</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="comment">// Attach a vector and context to each DM</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <span class="keywordflow">if</span> ( n_levels &gt;= 1 )</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      {</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 1; i &lt;= <a class="code" href="namespacelibMesh_1_1MeshTools.html#ae15ece869d4ef3d283edb677942e8439">n_levels</a> ; ++i)</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;          {</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;            DM &amp; dm = this-&gt;<a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a34bd5c1fa064d2c382a52607f4465c8f">get_dm</a>(i-1);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            ierr = DMShellSetGlobalVector( dm, <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">_ctx_vec</a>[i-1].current_vec-&gt;vec() );</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            CHKERRABORT(system.comm().get(), <a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>);</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;            ierr = DMShellSetContext( dm, &amp;<a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">_ctx_vec</a>[i-1] );</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            CHKERRABORT(system.comm().get(), <a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>);</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;          }</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      }</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="comment">// DM structures created, now we need projection matrixes if GMG is requested.</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="comment">// To prepare for projection creation go to second coarsest mesh so we can utilize</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="comment">// old_dof_indices information in the projection creation.</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="keywordflow">if</span> (n_levels &gt; 1 )</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      {</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        <span class="comment">// First, stash the coarse dof indices for FS purposes</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="tecplot__io_8C.html#ac001e4247887b98c2aa5b8ec5107ca0d">n_vars</a>  = system.n_vars();</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">_ctx_vec</a>[0].dof_vec.resize(n_vars);</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v = 0; v &lt; <a class="code" href="tecplot__io_8C.html#ac001e4247887b98c2aa5b8ec5107ca0d">n_vars</a>; v++ )</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;          {</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;            std::vector&lt;numeric_index_type&gt; di;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;            system.get_dof_map().local_variable_indices(di, system.get_mesh(), v);</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;            <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">_ctx_vec</a>[0].dof_vec[v] = di;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;          }</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        LOG_CALL (<span class="stringliteral">&quot;PDM_refine&quot;</span>, <span class="stringliteral">&quot;PetscDMWrapper&quot;</span>, mesh_refinement.uniformly_refine(1));</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        LOG_CALL (<span class="stringliteral">&quot;PDM_dist_dof&quot;</span>, <span class="stringliteral">&quot;PetscDMWrapper&quot;</span>, system.get_dof_map().distribute_dofs(mesh));</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        LOG_CALL (<span class="stringliteral">&quot;PDM_cnstrnts&quot;</span>, <span class="stringliteral">&quot;PetscDMWrapper&quot;</span>, system.reinit_constraints());</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        LOG_CALL (<span class="stringliteral">&quot;PDM_prep_send&quot;</span>, <span class="stringliteral">&quot;PetscDMWrapper&quot;</span>, system.get_dof_map().prepare_send_list());</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      }</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="comment">// Create the Interpolation Matrices between adjacent mesh levels</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 1 ; i &lt; <a class="code" href="namespacelibMesh_1_1MeshTools.html#ae15ece869d4ef3d283edb677942e8439">n_levels</a> ; ++i )</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      {</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        <span class="keywordflow">if</span> ( i != n_levels )</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;          {</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;            <span class="comment">// Stash the rest of the dof indices</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_vars  = system.n_vars();</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;            <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">_ctx_vec</a>[i].dof_vec.resize(n_vars);</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;            <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v = 0; v &lt; <a class="code" href="tecplot__io_8C.html#ac001e4247887b98c2aa5b8ec5107ca0d">n_vars</a>; v++ )</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;              {</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                std::vector&lt;numeric_index_type&gt; di;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                system.get_dof_map().local_variable_indices(di, system.get_mesh(), v);</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">_ctx_vec</a>[i].dof_vec[v] = di;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;              }</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ndofs_c = <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#ade81e2a381216f2d8ba1be473e46fc30">_mesh_dof_sizes</a>[i-1];</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ndofs_f = <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#ade81e2a381216f2d8ba1be473e46fc30">_mesh_dof_sizes</a>[i];</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;            <span class="comment">// Create the Interpolation matrix and set its pointer</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;            <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">_ctx_vec</a>[i-1].K_interp_ptr = <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a8db0313aa38a2acc547b5fefaac50027">_pmtx_vec</a>[i-1].get();</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">_ctx_vec</a>[i-1].K_sub_interp_ptr = <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a2e8ca5ec9955c8f2a2813ca8a70c922e">_subpmtx_vec</a>[i-1].get();</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ndofs_local     = system.get_dof_map().n_dofs_on_processor(system.processor_id());</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ndofs_old_first = system.get_dof_map().first_old_dof(system.processor_id());</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ndofs_old_end   = system.get_dof_map().end_old_dof(system.processor_id());</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ndofs_old_size  = ndofs_old_end - ndofs_old_first;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;            <span class="comment">// Init and zero the matrix</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;            <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">_ctx_vec</a>[i-1].K_interp_ptr-&gt;init(ndofs_f, ndofs_c, ndofs_local, ndofs_old_size, 30 , 20);</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;            <span class="comment">// Disable Mat destruction since PETSc destroys these for us</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;            <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">_ctx_vec</a>[i-1].K_interp_ptr-&gt;set_destroy_mat_on_exit(<span class="keyword">false</span>);</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;            <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">_ctx_vec</a>[i-1].K_sub_interp_ptr-&gt;set_destroy_mat_on_exit(<span class="keyword">false</span>);</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;            <span class="comment">// TODO: Projection matrix sparsity pattern?</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;            <span class="comment">//MatSetOption(_ctx_vec[i-1].K_interp_ptr-&gt;mat(), MAT_NEW_NONZERO_ALLOCATION_ERR, PETSC_FALSE);</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;            <span class="comment">// Compute the interpolation matrix and set K_interp_ptr</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            LOG_CALL (<span class="stringliteral">&quot;PDM_proj_mat&quot;</span>, <span class="stringliteral">&quot;PetscDMWrapper&quot;</span>, system.projection_matrix(*<a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">_ctx_vec</a>[i-1].K_interp_ptr));</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            <span class="comment">// Always close matrix that contains altered data</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">_ctx_vec</a>[i-1].K_interp_ptr-&gt;close();</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;          }</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <span class="comment">// Move to next grid to make next projection</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        <span class="keywordflow">if</span> ( i != n_levels - 1 )</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;          {</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            LOG_CALL (<span class="stringliteral">&quot;PDM_refine&quot;</span>, <span class="stringliteral">&quot;PetscDMWrapper&quot;</span>, mesh_refinement.uniformly_refine(1));</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;            LOG_CALL (<span class="stringliteral">&quot;PDM_dist_dof&quot;</span>, <span class="stringliteral">&quot;PetscDMWrapper&quot;</span>, system.get_dof_map().distribute_dofs(mesh));</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;            LOG_CALL (<span class="stringliteral">&quot;PDM_cnstrnts&quot;</span>, <span class="stringliteral">&quot;PetscDMWrapper&quot;</span>, system.reinit_constraints());</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;            LOG_CALL (<span class="stringliteral">&quot;PDM_prep_send&quot;</span>, <span class="stringliteral">&quot;PetscDMWrapper&quot;</span>, system.get_dof_map().prepare_send_list());</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;          }</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      } <span class="comment">// End create transfer operators. System back at the finest grid</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="comment">// Lastly, give SNES the finest level DM</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    DM &amp; dm = this-&gt;<a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a34bd5c1fa064d2c382a52607f4465c8f">get_dm</a>(n_levels-1);</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    ierr = SNESSetDM(snes, dm);</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    CHKERRABORT(system.comm().get(),<a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  }</div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_a2d70713d86345846096c6ef22258cf14"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#a2d70713d86345846096c6ef22258cf14">libMesh::PetscDMWrapper::init_dm_data</a></div><div class="ttdeci">void init_dm_data(unsigned int n_levels, const Parallel::Communicator &amp;comm)</div><div class="ttdoc">Init all the n_mesh_level dependent data structures. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8C_source.html#l01076">petsc_dm_wrapper.C:1076</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_a5d2cb2619787d5e29185d720bf5d74f1"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#a5d2cb2619787d5e29185d720bf5d74f1">libMesh::PetscDMWrapper::_vec_vec</a></div><div class="ttdeci">std::vector&lt; std::unique_ptr&lt; PetscVector&lt; Number &gt; &gt; &gt; _vec_vec</div><div class="ttdoc">Vector of solution vectors for all grid levels. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00164">petsc_dm_wrapper.h:164</a></div></div>
<div class="ttc" id="namespacelibMesh_html_a7e1c5da5a247e5c99321c2eac5776615"><div class="ttname"><a href="namespacelibMesh.html#a7e1c5da5a247e5c99321c2eac5776615">libMesh::command_line_next</a></div><div class="ttdeci">T command_line_next(std::string name, T value)</div><div class="ttdoc">Use GetPot&amp;#39;s search()/next() functions to get following arguments from the command line...</div><div class="ttdef"><b>Definition:</b> <a href="libmesh_8C_source.html#l00937">libmesh.C:937</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_aa29b614c713146bf8be8dc066ac4cdc3"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">libMesh::PetscDMWrapper::_ctx_vec</a></div><div class="ttdeci">std::vector&lt; PetscDMContext &gt; _ctx_vec</div><div class="ttdoc">Vector of internal PetscDM context structs for all grid levels Pointers to these C++ objects are pass...</div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00157">petsc_dm_wrapper.h:157</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_a34bd5c1fa064d2c382a52607f4465c8f"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#a34bd5c1fa064d2c382a52607f4465c8f">libMesh::PetscDMWrapper::get_dm</a></div><div class="ttdeci">DM &amp; get_dm(unsigned int level)</div><div class="ttdoc">Get reference to DM for the given mesh level. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00179">petsc_dm_wrapper.h:179</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_aa4d26a0e9269059e4e3436368ed29060"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#aa4d26a0e9269059e4e3436368ed29060">libMesh::PetscDMWrapper::_dms</a></div><div class="ttdeci">std::vector&lt; WrappedPetsc&lt; DM &gt; &gt; _dms</div><div class="ttdoc">Vector of DMs for all grid levels. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00117">petsc_dm_wrapper.h:117</a></div></div>
<div class="ttc" id="mesh__communication_8C_html_afaa03b874c297f4693d9cdef7f50f3c6"><div class="ttname"><a href="mesh__communication_8C.html#afaa03b874c297f4693d9cdef7f50f3c6">mesh</a></div><div class="ttdeci">MeshBase &amp; mesh</div><div class="ttdef"><b>Definition:</b> <a href="mesh__communication_8C_source.html#l01308">mesh_communication.C:1308</a></div></div>
<div class="ttc" id="tecplot__io_8C_html_ac001e4247887b98c2aa5b8ec5107ca0d"><div class="ttname"><a href="tecplot__io_8C.html#ac001e4247887b98c2aa5b8ec5107ca0d">n_vars</a></div><div class="ttdeci">const unsigned int n_vars</div><div class="ttdef"><b>Definition:</b> <a href="tecplot__io_8C_source.html#l00068">tecplot_io.C:68</a></div></div>
<div class="ttc" id="namespacelibMesh_html_acd02afd327990a8dc4975602e404d618"><div class="ttname"><a href="namespacelibMesh.html#acd02afd327990a8dc4975602e404d618">libMesh::libmesh_petsc_DMCreateInterpolation</a></div><div class="ttdeci">PetscErrorCode libmesh_petsc_DMCreateInterpolation(DM dmc, DM dmf, Mat *mat, Vec *vec)</div><div class="ttdoc">Function to give PETSc that sets the Interpolation Matrix between two DMs. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8C_source.html#l00310">petsc_dm_wrapper.C:310</a></div></div>
<div class="ttc" id="namespacelibMesh_html_a2511fc6b42db0db246617a34c8771a01"><div class="ttname"><a href="namespacelibMesh.html#a2511fc6b42db0db246617a34c8771a01">libMesh::libmesh_petsc_DMRefine</a></div><div class="ttdeci">PetscErrorCode libmesh_petsc_DMRefine(DM dmc, MPI_Comm, DM *dmf)</div><div class="ttdoc">Help PETSc identify the finer DM given a dmc. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8C_source.html#l00200">petsc_dm_wrapper.C:200</a></div></div>
<div class="ttc" id="namespacelibMesh_html_a2809ca711cb1f94c66ad00f235dec854"><div class="ttname"><a href="namespacelibMesh.html#a2809ca711cb1f94c66ad00f235dec854">libMesh::libmesh_petsc_DMCreateRestriction</a></div><div class="ttdeci">PetscErrorCode libmesh_petsc_DMCreateRestriction(DM dmc, DM dmf, Mat *mat)</div><div class="ttdoc">Function to give PETSc that sets the Restriction Matrix between two DMs. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8C_source.html#l00400">petsc_dm_wrapper.C:400</a></div></div>
<div class="ttc" id="namespacelibMesh_html_a03d02ae8c0dab01091f6b27bd0765c7d"><div class="ttname"><a href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">libMesh::ierr</a></div><div class="ttdeci">PetscErrorCode PetscInt const PetscInt IS DM *subdm PetscErrorCode ierr</div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8C_source.html#l00061">petsc_dm_wrapper.C:61</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_a8db0313aa38a2acc547b5fefaac50027"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#a8db0313aa38a2acc547b5fefaac50027">libMesh::PetscDMWrapper::_pmtx_vec</a></div><div class="ttdeci">std::vector&lt; std::unique_ptr&lt; PetscMatrix&lt; Number &gt; &gt; &gt; _pmtx_vec</div><div class="ttdoc">Vector of projection matrixes for all grid levels. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00143">petsc_dm_wrapper.h:143</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_a2e8ca5ec9955c8f2a2813ca8a70c922e"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#a2e8ca5ec9955c8f2a2813ca8a70c922e">libMesh::PetscDMWrapper::_subpmtx_vec</a></div><div class="ttdeci">std::vector&lt; std::unique_ptr&lt; PetscMatrix&lt; Number &gt; &gt; &gt; _subpmtx_vec</div><div class="ttdoc">Vector of sub projection matrixes for all grid levels for fieldsplit. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00150">petsc_dm_wrapper.h:150</a></div></div>
<div class="ttc" id="namespacelibMesh_1_1MeshTools_html_ae15ece869d4ef3d283edb677942e8439"><div class="ttname"><a href="namespacelibMesh_1_1MeshTools.html#ae15ece869d4ef3d283edb677942e8439">libMesh::MeshTools::n_levels</a></div><div class="ttdeci">unsigned int n_levels(const MeshBase &amp;mesh)</div><div class="ttdef"><b>Definition:</b> <a href="mesh__tools_8C_source.html#l00801">mesh_tools.C:801</a></div></div>
<div class="ttc" id="namespacelibMesh_html_a4f791f2cb1525c37e7916d564c3b3b78"><div class="ttname"><a href="namespacelibMesh.html#a4f791f2cb1525c37e7916d564c3b3b78">libMesh::libmesh_assert</a></div><div class="ttdeci">libmesh_assert(ctx)</div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_a6295b51ea21d5501420c2c171ac0afa6"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#a6295b51ea21d5501420c2c171ac0afa6">libMesh::PetscDMWrapper::get_section</a></div><div class="ttdeci">PetscSection &amp; get_section(unsigned int level)</div><div class="ttdoc">Get reference to PetscSection for the given mesh level. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00187">petsc_dm_wrapper.h:187</a></div></div>
<div class="ttc" id="namespacelibMesh_html_ad8f92d1a48957948f414ad82d8e9f8f8"><div class="ttname"><a href="namespacelibMesh.html#ad8f92d1a48957948f414ad82d8e9f8f8">libMesh::libmesh_petsc_DMCoarsen</a></div><div class="ttdeci">PetscErrorCode libmesh_petsc_DMCoarsen(DM dmf, MPI_Comm, DM *dmc)</div><div class="ttdoc">Help PETSc identify the coarser DM dmc given the fine DM dmf. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8C_source.html#l00222">petsc_dm_wrapper.C:222</a></div></div>
<div class="ttc" id="namespacelibMesh_html_a2643664981a6bdf371857274f11c13a0"><div class="ttname"><a href="namespacelibMesh.html#a2643664981a6bdf371857274f11c13a0">libMesh::libmesh_petsc_DMCreateSubDM</a></div><div class="ttdeci">PetscErrorCode libmesh_petsc_DMCreateSubDM(DM dm, PetscInt numFields, PetscInt fields[], IS *is, DM *subdm) PetscErrorCode libmesh_petsc_DMCreateSubDM(DM dm</div><div class="ttdoc">Help PETSc create a subDM given a global dm when using fieldsplit. </div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_ad236a8053fde71cf4344bc02c8af40a9"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#ad236a8053fde71cf4344bc02c8af40a9">libMesh::PetscDMWrapper::_mesh_dof_loc_sizes</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; _mesh_dof_loc_sizes</div><div class="ttdoc">Stores n_local_dofs for each grid level, to be used for projection vector sizing. ...</div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00170">petsc_dm_wrapper.h:170</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_aed2e29d969ca4c92ed1770477aa1a7ba"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#aed2e29d969ca4c92ed1770477aa1a7ba">libMesh::PetscDMWrapper::get_star_forest</a></div><div class="ttdeci">PetscSF &amp; get_star_forest(unsigned int level)</div><div class="ttdoc">Get reference to PetscSF for the given mesh level. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00195">petsc_dm_wrapper.h:195</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_ade81e2a381216f2d8ba1be473e46fc30"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#ade81e2a381216f2d8ba1be473e46fc30">libMesh::PetscDMWrapper::_mesh_dof_sizes</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; _mesh_dof_sizes</div><div class="ttdoc">Stores n_dofs for each grid level, to be used for projection matrix sizing. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00167">petsc_dm_wrapper.h:167</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_af9ebb64f4d3f5f353f91ac2fcbe6a198"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#af9ebb64f4d3f5f353f91ac2fcbe6a198">libMesh::PetscDMWrapper::build_section</a></div><div class="ttdeci">void build_section(const System &amp;system, PetscSection &amp;section)</div><div class="ttdoc">Takes System, empty PetscSection and populates the PetscSection. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8C_source.html#l00713">petsc_dm_wrapper.C:713</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_ab9a1fd9620e6cbef319c215a7341e8d4"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#ab9a1fd9620e6cbef319c215a7341e8d4">libMesh::PetscDMWrapper::build_sf</a></div><div class="ttdeci">void build_sf(const System &amp;system, PetscSF &amp;star_forest)</div><div class="ttdoc">Takes System, empty PetscSF and populates the PetscSF. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8C_source.html#l00777">petsc_dm_wrapper.C:777</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2d70713d86345846096c6ef22258cf14"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void libMesh::PetscDMWrapper::init_dm_data </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>n_levels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Parallel::Communicator &amp;&#160;</td>
          <td class="paramname"><em>comm</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Init all the n_mesh_level dependent data structures. </p>

<p>在文件 <a class="el" href="petsc__dm__wrapper_8C_source.html">petsc_dm_wrapper.C</a> 第 <a class="el" href="petsc__dm__wrapper_8C_source.html#l01076">1076</a> 行定义.</p>

<p>参考 <a class="el" href="petsc__dm__wrapper_8h_source.html#l00157">_ctx_vec</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00117">_dms</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00170">_mesh_dof_loc_sizes</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00167">_mesh_dof_sizes</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00143">_pmtx_vec</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00127">_sections</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00136">_star_forests</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00150">_subpmtx_vec</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00164">_vec_vec</a> , 以及 <a class="el" href="mesh__tools_8C_source.html#l00801">libMesh::MeshTools::n_levels()</a>.</p>

<p>参考自 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00451">init_and_attach_petscdm()</a>.</p>
<div class="fragment"><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  {</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa4d26a0e9269059e4e3436368ed29060">_dms</a>.resize(<a class="code" href="namespacelibMesh_1_1MeshTools.html#ae15ece869d4ef3d283edb677942e8439">n_levels</a>);</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a7b64223ac3403b535b0d687825aa16b1">_sections</a>.resize(<a class="code" href="namespacelibMesh_1_1MeshTools.html#ae15ece869d4ef3d283edb677942e8439">n_levels</a>);</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a8258edc20f6aa9603bc0ee44cd98132b">_star_forests</a>.resize(<a class="code" href="namespacelibMesh_1_1MeshTools.html#ae15ece869d4ef3d283edb677942e8439">n_levels</a>);</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">_ctx_vec</a>.resize(<a class="code" href="namespacelibMesh_1_1MeshTools.html#ae15ece869d4ef3d283edb677942e8439">n_levels</a>);</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a8db0313aa38a2acc547b5fefaac50027">_pmtx_vec</a>.resize(<a class="code" href="namespacelibMesh_1_1MeshTools.html#ae15ece869d4ef3d283edb677942e8439">n_levels</a>);</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a2e8ca5ec9955c8f2a2813ca8a70c922e">_subpmtx_vec</a>.resize(<a class="code" href="namespacelibMesh_1_1MeshTools.html#ae15ece869d4ef3d283edb677942e8439">n_levels</a>);</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a5d2cb2619787d5e29185d720bf5d74f1">_vec_vec</a>.resize(<a class="code" href="namespacelibMesh_1_1MeshTools.html#ae15ece869d4ef3d283edb677942e8439">n_levels</a>);</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#ade81e2a381216f2d8ba1be473e46fc30">_mesh_dof_sizes</a>.resize(<a class="code" href="namespacelibMesh_1_1MeshTools.html#ae15ece869d4ef3d283edb677942e8439">n_levels</a>);</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#ad236a8053fde71cf4344bc02c8af40a9">_mesh_dof_loc_sizes</a>.resize(<a class="code" href="namespacelibMesh_1_1MeshTools.html#ae15ece869d4ef3d283edb677942e8439">n_levels</a>);</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="namespacelibMesh_1_1MeshTools.html#ae15ece869d4ef3d283edb677942e8439">n_levels</a>; i++ )</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;      {</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        <span class="comment">// Call C++ object constructors</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a8db0313aa38a2acc547b5fefaac50027">_pmtx_vec</a>[i] = std::make_unique&lt;PetscMatrix&lt;Number&gt;&gt;(comm);</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;        <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a2e8ca5ec9955c8f2a2813ca8a70c922e">_subpmtx_vec</a>[i] = std::make_unique&lt;PetscMatrix&lt;Number&gt;&gt;(comm);</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;        <a class="code" href="classlibMesh_1_1PetscDMWrapper.html#a5d2cb2619787d5e29185d720bf5d74f1">_vec_vec</a>[i] = std::make_unique&lt;PetscVector&lt;Number&gt;&gt;(comm);</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;      }</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;  }</div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_a5d2cb2619787d5e29185d720bf5d74f1"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#a5d2cb2619787d5e29185d720bf5d74f1">libMesh::PetscDMWrapper::_vec_vec</a></div><div class="ttdeci">std::vector&lt; std::unique_ptr&lt; PetscVector&lt; Number &gt; &gt; &gt; _vec_vec</div><div class="ttdoc">Vector of solution vectors for all grid levels. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00164">petsc_dm_wrapper.h:164</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_aa29b614c713146bf8be8dc066ac4cdc3"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#aa29b614c713146bf8be8dc066ac4cdc3">libMesh::PetscDMWrapper::_ctx_vec</a></div><div class="ttdeci">std::vector&lt; PetscDMContext &gt; _ctx_vec</div><div class="ttdoc">Vector of internal PetscDM context structs for all grid levels Pointers to these C++ objects are pass...</div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00157">petsc_dm_wrapper.h:157</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_aa4d26a0e9269059e4e3436368ed29060"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#aa4d26a0e9269059e4e3436368ed29060">libMesh::PetscDMWrapper::_dms</a></div><div class="ttdeci">std::vector&lt; WrappedPetsc&lt; DM &gt; &gt; _dms</div><div class="ttdoc">Vector of DMs for all grid levels. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00117">petsc_dm_wrapper.h:117</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_a8db0313aa38a2acc547b5fefaac50027"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#a8db0313aa38a2acc547b5fefaac50027">libMesh::PetscDMWrapper::_pmtx_vec</a></div><div class="ttdeci">std::vector&lt; std::unique_ptr&lt; PetscMatrix&lt; Number &gt; &gt; &gt; _pmtx_vec</div><div class="ttdoc">Vector of projection matrixes for all grid levels. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00143">petsc_dm_wrapper.h:143</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_a2e8ca5ec9955c8f2a2813ca8a70c922e"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#a2e8ca5ec9955c8f2a2813ca8a70c922e">libMesh::PetscDMWrapper::_subpmtx_vec</a></div><div class="ttdeci">std::vector&lt; std::unique_ptr&lt; PetscMatrix&lt; Number &gt; &gt; &gt; _subpmtx_vec</div><div class="ttdoc">Vector of sub projection matrixes for all grid levels for fieldsplit. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00150">petsc_dm_wrapper.h:150</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_a7b64223ac3403b535b0d687825aa16b1"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#a7b64223ac3403b535b0d687825aa16b1">libMesh::PetscDMWrapper::_sections</a></div><div class="ttdeci">std::vector&lt; WrappedPetsc&lt; PetscSection &gt; &gt; _sections</div><div class="ttdoc">Vector of PETScSections for all grid levels. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00127">petsc_dm_wrapper.h:127</a></div></div>
<div class="ttc" id="namespacelibMesh_1_1MeshTools_html_ae15ece869d4ef3d283edb677942e8439"><div class="ttname"><a href="namespacelibMesh_1_1MeshTools.html#ae15ece869d4ef3d283edb677942e8439">libMesh::MeshTools::n_levels</a></div><div class="ttdeci">unsigned int n_levels(const MeshBase &amp;mesh)</div><div class="ttdef"><b>Definition:</b> <a href="mesh__tools_8C_source.html#l00801">mesh_tools.C:801</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_ad236a8053fde71cf4344bc02c8af40a9"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#ad236a8053fde71cf4344bc02c8af40a9">libMesh::PetscDMWrapper::_mesh_dof_loc_sizes</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; _mesh_dof_loc_sizes</div><div class="ttdoc">Stores n_local_dofs for each grid level, to be used for projection vector sizing. ...</div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00170">petsc_dm_wrapper.h:170</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_a8258edc20f6aa9603bc0ee44cd98132b"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#a8258edc20f6aa9603bc0ee44cd98132b">libMesh::PetscDMWrapper::_star_forests</a></div><div class="ttdeci">std::vector&lt; PetscSF &gt; _star_forests</div><div class="ttdoc">Vector of star forests for all grid levels. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00136">petsc_dm_wrapper.h:136</a></div></div>
<div class="ttc" id="classlibMesh_1_1PetscDMWrapper_html_ade81e2a381216f2d8ba1be473e46fc30"><div class="ttname"><a href="classlibMesh_1_1PetscDMWrapper.html#ade81e2a381216f2d8ba1be473e46fc30">libMesh::PetscDMWrapper::_mesh_dof_sizes</a></div><div class="ttdeci">std::vector&lt; unsigned int &gt; _mesh_dof_sizes</div><div class="ttdoc">Stores n_dofs for each grid level, to be used for projection matrix sizing. </div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8h_source.html#l00167">petsc_dm_wrapper.h:167</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6f5911ff56027bac98ee7000d81ab3c2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void libMesh::PetscDMWrapper::set_point_range_in_section </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlibMesh_1_1System.html">System</a> &amp;&#160;</td>
          <td class="paramname"><em>system</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscSection &amp;&#160;</td>
          <td class="paramname"><em>section</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::unordered_map&lt; <a class="el" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a>, <a class="el" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>node_map</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::unordered_map&lt; <a class="el" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a>, <a class="el" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>elem_map</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::map&lt; <a class="el" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a>, unsigned int &gt; &amp;&#160;</td>
          <td class="paramname"><em>scalar_map</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Helper function for build_section. </p>
<p>This function will count how many "points" on the current processor have DoFs associated with them and give that count to PETSc. We need to cache a mapping between the global node id and our local count that we do in this function because we will need the local number again in the add_dofs_to_section function. </p>

<p>在文件 <a class="el" href="petsc__dm__wrapper_8C_source.html">petsc_dm_wrapper.C</a> 第 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00846">846</a> 行定义.</p>

<p>参考 <a class="el" href="parallel__object_8h_source.html#l00097">libMesh::ParallelObject::comm()</a>, <a class="el" href="dof__map_8C_source.html#l01992">libMesh::DofMap::dof_indices()</a>, <a class="el" href="fe__type_8h_source.html#l00207">libMesh::FEType::family</a>, <a class="el" href="system_8h_source.html#l02293">libMesh::System::get_dof_map()</a>, <a class="el" href="system_8h_source.html#l02277">libMesh::System::get_mesh()</a>, <a class="el" href="petsc__dm__wrapper_8C_source.html#l00061">libMesh::ierr</a>, <a class="el" href="namespacelibMesh.html#a4f791f2cb1525c37e7916d564c3b3b78">libMesh::libmesh_assert()</a>, <a class="el" href="dof__map_8h_source.html#l00831">libMesh::DofMap::local_index()</a>, <a class="el" href="int__range_8h_source.html#l00134">libMesh::make_range()</a>, <a class="el" href="mesh__communication_8C_source.html#l01308">mesh</a>, <a class="el" href="mesh__base_8h_source.html#l00540">libMesh::MeshBase::n_active_local_elem()</a>, <a class="el" href="dof__map_8h_source.html#l00669">libMesh::DofMap::n_local_dofs()</a>, <a class="el" href="mesh__base_8h_source.html#l00417">libMesh::MeshBase::n_local_nodes()</a>, <a class="el" href="parallel__object_8h_source.html#l00103">libMesh::ParallelObject::n_processors()</a>, <a class="el" href="dof__map_8h_source.html#l00664">libMesh::DofMap::n_SCALAR_dofs()</a>, <a class="el" href="system_8h_source.html#l02349">libMesh::System::n_vars()</a>, <a class="el" href="system_8h_source.html#l02269">libMesh::System::number()</a>, <a class="el" href="parallel__object_8h_source.html#l00114">libMesh::ParallelObject::processor_id()</a>, <a class="el" href="enum__fe__family_8h_source.html#l00058">libMesh::SCALAR</a>, <a class="el" href="variable_8h_source.html#l00140">libMesh::Variable::type()</a> , 以及 <a class="el" href="system_8h_source.html#l02377">libMesh::System::variable()</a>.</p>

<p>参考自 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00713">build_section()</a>.</p>
<div class="fragment"><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  {</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <span class="comment">// We&#39;re expecting this to be empty coming in</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <a class="code" href="namespacelibMesh.html#a4f791f2cb1525c37e7916d564c3b3b78">libmesh_assert</a>(node_map.empty());</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <span class="comment">// We need to count up the number of active &quot;points&quot; on this processor.</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <span class="comment">// Nominally, a &quot;point&quot; in PETSc parlance is a geometric object that can</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <span class="comment">// hold DoFs, i.e node, edge, face, elem. Since we handle the mesh and are only</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="comment">// interested in solvers, then the only thing PETSc needs is a unique *local* number</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="comment">// for each &quot;point&quot; that has active DoFs; note however this local numbering</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <span class="comment">// we construct must be continuous.</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="comment">//</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <span class="comment">// In libMesh, for most finite elements, we just associate those DoFs with the</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <span class="comment">// geometric nodes. So can we loop over the nodes on this processor and check</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="comment">// if any of the fields are have active DoFs on that node.</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <span class="comment">// If so, then we tell PETSc about that &quot;point&quot;. At this stage, we just need</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    <span class="comment">// to count up how many active &quot;points&quot; we have and cache the local number to global id</span></div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    <span class="comment">// mapping.</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <span class="comment">// These will be our local counters. pstart should always be zero.</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="comment">// pend will track our local &quot;point&quot; count.</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <span class="comment">// If we&#39;re on a processor who coarsened the mesh to have no local elements,</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="comment">// we should make an empty PetscSection. An empty PetscSection is specified</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    <span class="comment">// by passing [0,0) to the PetscSectionSetChart call at the end. So, if we</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <span class="comment">// have nothing on this processor, these are the correct values to pass to</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <span class="comment">// PETSc.</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <a class="code" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a> pstart = 0;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <a class="code" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a> pend = 0;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    <span class="keyword">const</span> MeshBase &amp; <a class="code" href="mesh__communication_8C.html#afaa03b874c297f4693d9cdef7f50f3c6">mesh</a> = system.get_mesh();</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <span class="keyword">const</span> DofMap &amp; dof_map = system.get_dof_map();</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="comment">// If we don&#39;t have any local dofs, then there&#39;s nothing to tell to the PetscSection</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <span class="keywordflow">if</span> (dof_map.n_local_dofs() &gt; 0)</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      {</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        <span class="comment">// Conservative estimate of space needed so we don&#39;t thrash</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        node_map.reserve(mesh.n_local_nodes());</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        elem_map.reserve(mesh.n_active_local_elem());</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        <span class="comment">// We loop over active elements and then cache the global/local node mapping to make sure</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        <span class="comment">// we only count active nodes. For example, if we&#39;re calling this function and we&#39;re</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        <span class="comment">// not the finest level in the Mesh tree, we don&#39;t want to include nodes of child elements</span></div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        <span class="comment">// that aren&#39;t active on this level.</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp; elem : mesh.active_local_element_ptr_range())</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;          {</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;            <span class="keywordflow">for</span> (<span class="keyword">const</span> Node &amp; node : elem-&gt;node_ref_range())</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;              {</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;                <span class="comment">// get the global id number of local node n</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                <span class="comment">// Only register nodes with the PetscSection if they have dofs that belong to</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;                <span class="comment">// this processor. Even though we&#39;re active local elements, the dofs associated</span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;                <span class="comment">// with the node may belong to a different processor. The processor who owns</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;                <span class="comment">// those dofs will register that node with the PetscSection on that processor.</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;                std::vector&lt;dof_id_type&gt; node_dof_indices;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                dof_map.dof_indices( &amp;node, node_dof_indices );</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;                <span class="keywordflow">if</span>( !node_dof_indices.empty() &amp;&amp; dof_map.local_index(node_dof_indices[0]) )</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                  {</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;<span class="preprocessor"></span>                    <span class="comment">// We&#39;re assuming that if the first dof for this node belongs to this processor,</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                    <span class="comment">// then all of them do.</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;                    <span class="keywordflow">for</span>( <span class="keyword">auto</span> dof : node_dof_indices )</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                      <a class="code" href="namespacelibMesh.html#a4f791f2cb1525c37e7916d564c3b3b78">libmesh_assert</a>(dof_map.local_index(dof));</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="preprocessor"></span>                    <span class="comment">// Cache the global/local mapping if we haven&#39;t already</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;                    <span class="comment">// Then increment our local count</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                    <a class="code" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a> node_id = node.id();</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                    <span class="keywordflow">if</span>( node_map.count(node_id) == 0 )</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                      {</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                        node_map.emplace(node_id, pend);</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                        pend++;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                      }</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                  }</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;              }</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;            <span class="comment">// Some finite elements, e.g. Hierarchic, associate element interior DoFs with the element</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;            <span class="comment">// rather than the node (since we ought to be able to use Hierachic elements on a QUAD4,</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;            <span class="comment">// which has no interior node). Thus, we also need to check element interiors for DoFs</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;            <span class="comment">// as well and, if the finite element has them, we also need to count the Elem in our</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;            <span class="comment">// &quot;point&quot; accounting.</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;            <span class="keywordflow">if</span>( elem-&gt;n_dofs(system.number()) &gt; 0 )</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;              {</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;                <a class="code" href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">dof_id_type</a> elem_id = elem-&gt;id();</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;                elem_map.emplace(elem_id, pend);</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                pend++;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;              }</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;          }</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        <span class="comment">// SCALAR dofs live on the &quot;last&quot; processor, so only work there if there are any</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        <span class="keywordflow">if</span>( dof_map.n_SCALAR_dofs() &gt; 0 &amp;&amp; (system.processor_id() == (system.n_processors()-1)) )</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;          {</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;            <span class="comment">// Loop through all the variables and cache the scalar ones. We cache the</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;            <span class="comment">// SCALAR variable index along with the local point to make it easier when</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;            <span class="comment">// we have to register dofs with the PetscSection</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;            <span class="keywordflow">for</span> (<span class="keyword">auto</span> v : <a class="code" href="namespacelibMesh.html#a18dea64f5cc7fa12c864d7571bb69d0b">make_range</a>(system.n_vars()))</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;              {</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;                <span class="keywordflow">if</span>( system.variable(v).type().family == <a class="code" href="namespacelibMesh.html#abcdbcd8364bf9fb7a67b3b4013031b2daefdbf95da65edcfa0cdb6c10eac5482c">SCALAR</a> )</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;                  {</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;                    scalar_map.emplace(pend, v);</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;                    pend++;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                  }</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;              }</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;          }</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;      }</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    PetscErrorCode <a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a> = PetscSectionSetChart(section, pstart, pend);</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    CHKERRABORT(system.comm().get(),<a class="code" href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">ierr</a>);</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  }</div>
<div class="ttc" id="namespacelibMesh_html_abcdbcd8364bf9fb7a67b3b4013031b2daefdbf95da65edcfa0cdb6c10eac5482c"><div class="ttname"><a href="namespacelibMesh.html#abcdbcd8364bf9fb7a67b3b4013031b2daefdbf95da65edcfa0cdb6c10eac5482c">libMesh::SCALAR</a></div><div class="ttdef"><b>Definition:</b> <a href="enum__fe__family_8h_source.html#l00058">enum_fe_family.h:58</a></div></div>
<div class="ttc" id="mesh__communication_8C_html_afaa03b874c297f4693d9cdef7f50f3c6"><div class="ttname"><a href="mesh__communication_8C.html#afaa03b874c297f4693d9cdef7f50f3c6">mesh</a></div><div class="ttdeci">MeshBase &amp; mesh</div><div class="ttdef"><b>Definition:</b> <a href="mesh__communication_8C_source.html#l01308">mesh_communication.C:1308</a></div></div>
<div class="ttc" id="namespacelibMesh_html_a03d02ae8c0dab01091f6b27bd0765c7d"><div class="ttname"><a href="namespacelibMesh.html#a03d02ae8c0dab01091f6b27bd0765c7d">libMesh::ierr</a></div><div class="ttdeci">PetscErrorCode PetscInt const PetscInt IS DM *subdm PetscErrorCode ierr</div><div class="ttdef"><b>Definition:</b> <a href="petsc__dm__wrapper_8C_source.html#l00061">petsc_dm_wrapper.C:61</a></div></div>
<div class="ttc" id="namespacelibMesh_html_a4f791f2cb1525c37e7916d564c3b3b78"><div class="ttname"><a href="namespacelibMesh.html#a4f791f2cb1525c37e7916d564c3b3b78">libMesh::libmesh_assert</a></div><div class="ttdeci">libmesh_assert(ctx)</div></div>
<div class="ttc" id="namespacelibMesh_html_a18dea64f5cc7fa12c864d7571bb69d0b"><div class="ttname"><a href="namespacelibMesh.html#a18dea64f5cc7fa12c864d7571bb69d0b">libMesh::make_range</a></div><div class="ttdeci">IntRange&lt; T &gt; make_range(T beg, T end)</div><div class="ttdoc">The 2-parameter make_range() helper function returns an IntRange&amp;lt;T&amp;gt; when both input parameters are of...</div><div class="ttdef"><b>Definition:</b> <a href="int__range_8h_source.html#l00134">int_range.h:134</a></div></div>
<div class="ttc" id="namespacelibMesh_html_ab4541d74809228310a715b11c40587fc"><div class="ttname"><a href="namespacelibMesh.html#ab4541d74809228310a715b11c40587fc">libMesh::dof_id_type</a></div><div class="ttdeci">uint8_t dof_id_type</div><div class="ttdef"><b>Definition:</b> <a href="id__types_8h_source.html#l00067">id_types.h:67</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">类成员变量说明</h2>
<a class="anchor" id="aa29b614c713146bf8be8dc066ac4cdc3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="structlibMesh_1_1PetscDMContext.html">PetscDMContext</a>&gt; libMesh::PetscDMWrapper::_ctx_vec</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Vector of internal PetscDM context structs for all grid levels Pointers to these C++ objects are passed to DMShellSetContext(), they are cleaned up automatically by their destructors. </p>

<p>在文件 <a class="el" href="petsc__dm__wrapper_8h_source.html">petsc_dm_wrapper.h</a> 第 <a class="el" href="petsc__dm__wrapper_8h_source.html#l00157">157</a> 行定义.</p>

<p>参考自 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00430">clear()</a>, <a class="el" href="petsc__dm__wrapper_8C_source.html#l00451">init_and_attach_petscdm()</a> , 以及 <a class="el" href="petsc__dm__wrapper_8C_source.html#l01076">init_dm_data()</a>.</p>

</div>
</div>
<a class="anchor" id="aa4d26a0e9269059e4e3436368ed29060"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="structlibMesh_1_1WrappedPetsc.html">WrappedPetsc</a>&lt;DM&gt; &gt; libMesh::PetscDMWrapper::_dms</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Vector of DMs for all grid levels. </p>
<p>These are PETSc objects created by calling DMShellCreate(), so we are responsible for cleaning them up. </p>

<p>在文件 <a class="el" href="petsc__dm__wrapper_8h_source.html">petsc_dm_wrapper.h</a> 第 <a class="el" href="petsc__dm__wrapper_8h_source.html#l00117">117</a> 行定义.</p>

<p>参考自 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00430">clear()</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00179">get_dm()</a>, <a class="el" href="petsc__dm__wrapper_8C_source.html#l00451">init_and_attach_petscdm()</a> , 以及 <a class="el" href="petsc__dm__wrapper_8C_source.html#l01076">init_dm_data()</a>.</p>

</div>
</div>
<a class="anchor" id="ad236a8053fde71cf4344bc02c8af40a9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;unsigned int&gt; libMesh::PetscDMWrapper::_mesh_dof_loc_sizes</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Stores n_local_dofs for each grid level, to be used for projection vector sizing. </p>

<p>在文件 <a class="el" href="petsc__dm__wrapper_8h_source.html">petsc_dm_wrapper.h</a> 第 <a class="el" href="petsc__dm__wrapper_8h_source.html#l00170">170</a> 行定义.</p>

<p>参考自 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00430">clear()</a>, <a class="el" href="petsc__dm__wrapper_8C_source.html#l00451">init_and_attach_petscdm()</a> , 以及 <a class="el" href="petsc__dm__wrapper_8C_source.html#l01076">init_dm_data()</a>.</p>

</div>
</div>
<a class="anchor" id="ade81e2a381216f2d8ba1be473e46fc30"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;unsigned int&gt; libMesh::PetscDMWrapper::_mesh_dof_sizes</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Stores n_dofs for each grid level, to be used for projection matrix sizing. </p>

<p>在文件 <a class="el" href="petsc__dm__wrapper_8h_source.html">petsc_dm_wrapper.h</a> 第 <a class="el" href="petsc__dm__wrapper_8h_source.html#l00167">167</a> 行定义.</p>

<p>参考自 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00430">clear()</a>, <a class="el" href="petsc__dm__wrapper_8C_source.html#l00451">init_and_attach_petscdm()</a> , 以及 <a class="el" href="petsc__dm__wrapper_8C_source.html#l01076">init_dm_data()</a>.</p>

</div>
</div>
<a class="anchor" id="a8db0313aa38a2acc547b5fefaac50027"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;std::unique_ptr&lt;<a class="el" href="classlibMesh_1_1PetscMatrix.html">PetscMatrix</a>&lt;<a class="el" href="namespacelibMesh.html#a8b17bf24a15bc292850c3a3894e2e8f9">Number</a>&gt; &gt; &gt; libMesh::PetscDMWrapper::_pmtx_vec</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Vector of projection matrixes for all grid levels. </p>
<p>These are C++ objects, they are cleaned up automatically by their destructors. </p>

<p>在文件 <a class="el" href="petsc__dm__wrapper_8h_source.html">petsc_dm_wrapper.h</a> 第 <a class="el" href="petsc__dm__wrapper_8h_source.html#l00143">143</a> 行定义.</p>

<p>参考自 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00430">clear()</a>, <a class="el" href="petsc__dm__wrapper_8C_source.html#l00451">init_and_attach_petscdm()</a> , 以及 <a class="el" href="petsc__dm__wrapper_8C_source.html#l01076">init_dm_data()</a>.</p>

</div>
</div>
<a class="anchor" id="a7b64223ac3403b535b0d687825aa16b1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="structlibMesh_1_1WrappedPetsc.html">WrappedPetsc</a>&lt;PetscSection&gt; &gt; libMesh::PetscDMWrapper::_sections</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Vector of PETScSections for all grid levels. </p>
<p>These are PETSc objects which are attached to the DM by calling DMSetLocalSection(). While the DM takes care of destroying existing PetscSections in calls to DMSetLocalSection(), it does not appear to clean up PetscSections it holds when it is destroyed, so we manage their lifetimes using <a class="el" href="structlibMesh_1_1WrappedPetsc.html">WrappedPetsc</a> objects. </p>

<p>在文件 <a class="el" href="petsc__dm__wrapper_8h_source.html">petsc_dm_wrapper.h</a> 第 <a class="el" href="petsc__dm__wrapper_8h_source.html#l00127">127</a> 行定义.</p>

<p>参考自 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00430">clear()</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00187">get_section()</a> , 以及 <a class="el" href="petsc__dm__wrapper_8C_source.html#l01076">init_dm_data()</a>.</p>

</div>
</div>
<a class="anchor" id="a8258edc20f6aa9603bc0ee44cd98132b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;PetscSF&gt; libMesh::PetscDMWrapper::_star_forests</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Vector of star forests for all grid levels. </p>
<p>These are PETSc objects which are attached to the DM by calling DMSetSectionSF(). The DM seems to take care of cleaning these up itself as far as I can tell, so we do not try to manage their lifetime in any way. </p>

<p>在文件 <a class="el" href="petsc__dm__wrapper_8h_source.html">petsc_dm_wrapper.h</a> 第 <a class="el" href="petsc__dm__wrapper_8h_source.html#l00136">136</a> 行定义.</p>

<p>参考自 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00430">clear()</a>, <a class="el" href="petsc__dm__wrapper_8h_source.html#l00195">get_star_forest()</a> , 以及 <a class="el" href="petsc__dm__wrapper_8C_source.html#l01076">init_dm_data()</a>.</p>

</div>
</div>
<a class="anchor" id="a2e8ca5ec9955c8f2a2813ca8a70c922e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;std::unique_ptr&lt;<a class="el" href="classlibMesh_1_1PetscMatrix.html">PetscMatrix</a>&lt;<a class="el" href="namespacelibMesh.html#a8b17bf24a15bc292850c3a3894e2e8f9">Number</a>&gt; &gt; &gt; libMesh::PetscDMWrapper::_subpmtx_vec</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Vector of sub projection matrixes for all grid levels for fieldsplit. </p>
<p>These are C++ objects, they are cleaned up automatically by their destructors. </p>

<p>在文件 <a class="el" href="petsc__dm__wrapper_8h_source.html">petsc_dm_wrapper.h</a> 第 <a class="el" href="petsc__dm__wrapper_8h_source.html#l00150">150</a> 行定义.</p>

<p>参考自 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00430">clear()</a>, <a class="el" href="petsc__dm__wrapper_8C_source.html#l00451">init_and_attach_petscdm()</a> , 以及 <a class="el" href="petsc__dm__wrapper_8C_source.html#l01076">init_dm_data()</a>.</p>

</div>
</div>
<a class="anchor" id="a5d2cb2619787d5e29185d720bf5d74f1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;std::unique_ptr&lt;<a class="el" href="classlibMesh_1_1PetscVector.html">PetscVector</a>&lt;<a class="el" href="namespacelibMesh.html#a8b17bf24a15bc292850c3a3894e2e8f9">Number</a>&gt; &gt; &gt; libMesh::PetscDMWrapper::_vec_vec</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Vector of solution vectors for all grid levels. </p>
<p>These are C++ objects, they are cleaned up automatically by their destructors. </p>

<p>在文件 <a class="el" href="petsc__dm__wrapper_8h_source.html">petsc_dm_wrapper.h</a> 第 <a class="el" href="petsc__dm__wrapper_8h_source.html#l00164">164</a> 行定义.</p>

<p>参考自 <a class="el" href="petsc__dm__wrapper_8C_source.html#l00430">clear()</a>, <a class="el" href="petsc__dm__wrapper_8C_source.html#l00451">init_and_attach_petscdm()</a> , 以及 <a class="el" href="petsc__dm__wrapper_8C_source.html#l01076">init_dm_data()</a>.</p>

</div>
</div>
<hr/>该类的文档由以下文件生成:<ul>
<li>/home/lwz/libmesh/include/solvers/<a class="el" href="petsc__dm__wrapper_8h_source.html">petsc_dm_wrapper.h</a></li>
<li>/home/lwz/libmesh/src/solvers/<a class="el" href="petsc__dm__wrapper_8C_source.html">petsc_dm_wrapper.C</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
生成于 2023年 十二月 20日 星期三 12:09:41 , 为 libmesh解析使用  &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
